\documentclass[12pt, twoside, onehalfspace, numbers, spanish]{ezthesis}
%\usepackage[letterpaper,top=35mm,bottom=35mm,inner=30mm,outer=30mm]{geometry}
\usepackage[utf8x]{inputenc}
\usepackage{fancyhdr}
\usepackage[bottom]{footmisc}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{pbox}
\usepackage[makeroom]{cancel}
\usepackage{float}
\usepackage{titlesec}
\usepackage{caption}
\usepackage{multirow}
\usepackage{newfloat}
\usepackage{gensymb}
\usepackage{array}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{pdfpages}
\usepackage{xcolor}
\usepackage{times}
\usepackage{tikz}
\usepackage{listings}
\usepackage[labelfont=bf]{caption}
%\usepackage{dsfont}
\DeclareFloatingEnvironment[name={Gráfico}]{graph}
%\numberwithin{graph}{section}
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}
\setcounter{MaxMatrixCols}{20}
\numberwithin{equation}{section}
%\numberwithin{figure}{section}
\usepackage{hyperref}


\date{\today}
\renewcommand{\listtablename}{Índice de tablas}
\renewcommand{\listfigurename}{Índice de figuras}
\renewcommand{\contentsname}{Contenidos}
\renewcommand\bibname{Bibliografía}
\renewcommand\appendixname{Apéndice}
\renewcommand\tablename{Tabla}
\renewcommand\figurename{Figura}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\circled}[1]{\tikz[baseline=(char.base)]{\node[shape=circle,draw,inner sep=1pt] (char) {#1};}}
\newcommand\varpm{\mathbin{\vcenter{\hbox{\oalign{\hfil$\scriptstyle+$\hfil\cr\noalign{\kern-.3ex}$\scriptscriptstyle({-})$\cr}}}}}
\newcommand\varmp{\mathbin{\vcenter{\hbox{\oalign{$\scriptstyle({+})$\cr\noalign{\kern-.3ex}\hfil$\scriptscriptstyle-$\hfil\cr}}}}}
\newcommand\votwo{\mathbin{\vcenter{\hbox{\oalign{\hfil$\scriptstyle1$\hfil\cr\noalign{\kern-.3ex}$\scriptscriptstyle({2})$\cr}}}}}
\newcommand{\angstrom}{\text{\normalfont\AA}}
\def\blankpage{%
      \clearpage%
      \thispagestyle{empty}%
      \addtocounter{page}{-1}%
      \null%
      \clearpage}
%\renewcommand{\baselinestretch}{1.5}
\linespread{1.25}

\author{Nicolás Espinoza Muñoz}
\title{MODELACIÓN NUMÉRICA DE UNA PROTEÍNA INSERTA EN UNA MEMBRANA CELULAR USANDO EL MÉTODO DE ELEMENTOS DE BORDE.}
\supervisor{Christopher D. Cooper V., Ph.D.}
\correferent{Harvey A. Zambrano R., Ph.D.}
\institution{UNIVERSIDAD TÉCNICA FEDERICO SANTA MARÍA}
\department{DEPARTAMENTO DE INGENIERÍA MECÁNICA}
\city{VALPARAISO}
\country{CHILE}

\titleformat{\chapter}[display]
{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titlespacing*{\chapter}{0pt}{0pt}{20pt}

%\geometry{letterpaper,top=35mm,bottom=35mm,inner=30mm,outer=30mm}
%\geometry{top=35mm,bottom=35mm,inner=30mm,outer=30mm}

\begin{document}
\pagenumbering{roman}
\sloppy

\begin{figure}
	\includepdf[pages=1]{Portada.pdf}.
\end{figure}
\begin{picture}(150,150)
	\put(70,-50){\includegraphics[scale = 0.6]{./Figures/utfsm_logo.pdf}}
\end{picture}
\include{Agradecimientos}
\blankpage
\pagebreak
\include{Resumen}
\pagebreak
\include{Abstract}

\newpage
\thispagestyle{empty}
\noindent
\\\\\\\\\\\\\\\\
\large{``\textit{The greatest danger for most of us}}
\begin{center}
\large{\textit{is not that our aim is too high and we miss it,}}
\end{center}
\begin{flushright}
\large{\textit{but that it is too low and we reach it.}"\\}\bigskip
- Michelangelo
\end{flushright}
\newpage
\tableofcontents
\newpage
\phantomsection
\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures
%%%% Indice de tablas
\newpage
\phantomsection
\addcontentsline{toc}{chapter}{\listtablename}
\listoftables

\include{nomenclatura}

\pagenumbering{arabic}
\chapter{Introducción}\label{Chap:Intro}
La complejidad de los fenómenos biológicos hace que sea imposible hasta el momento analizar de manera completa su naturaleza. Es por esto que actualmente se estudian de manera exhaustiva nuevas formas de representar los sistemas biológicos o sus elementos conformantes, recurriendo a múltiples disciplinas y enfoques. Por nombrar ejemplos de ramas de la ciencia relevantes se tienen la electrodinámica, la termodinámica, la mecánica de sólidos, y mecánica estadística, aunque de ninguna manera son las únicas. Además, al igual que en muchas otras áreas, la computación se tomó gran parte del escenario, volviéndose quizás la herramienta más útil y usada en las investigaciones y avances en la comprensión de la biología celular.\\\\
Para modelar la fenomenología de los sistemas biológicos según las diferentes disciplinas científicas mencionadas se utiliza una cantidad de métodos computacionales, de los cuales quizás los más conocidos son la dinámica molecular (MD) en casos explícitos y el método de elementos finitos (FEM) en casos implícitos. Por supuesto y como todo en la vida, ambos tienen sus ventajas y desventajas; un punto en contra que tienen en común ambos tipos de modelación es que en general son lentos (MD más que FEM). Por esto es que ha empezado a tomar cada vez más fuerza el método de elementos de borde/frontera (BEM), que permite resolver problemas físicos comparativamente rápido a expensas de una formulación un tanto más compleja.\\\\
Por tanto y utilizando este método, el objetivo global de este trabajo consiste en obtener las ecuaciones de Green que permiten representar cargas en un medio acotado por dos interfaces paralelas, implementarlo en un programa de cálculo energético, y contrastar los resultados con aquellos de códigos o programas ya validados. Sumado a esto, la idea es que dicha implementación sea computacionalmente barata, conserve un buen nivel de precisión, y que la velocidad de cálculo sea competitiva frente a un programa de referencia en casos de estudio seleccionados.\\\\
La física de lo que buscamos representar consiste en una molécula totalmente embebida en una membrana de cierto espesor $a$, cuyos límites son superficies planas infinitas. Este sistema se modela a través de cargas imágenes mediante el método BEM, y esquemáticamente se muestra en la figura \ref{Fig:Intro}.

\begin{figure}[h]
\centering
\input{./Figures/Fig_Intro.eps_tex}
\caption{Esquema de la situación física que se quiere modelar: una proteína en una membrana.}\label{Fig:Intro}
\end{figure}
\noindent
Hay que tener presente que existen otros fenómenos además de los electrostáticos que no se consideran por la gran complejidad que conllevan; por ejemplo, la inversión de carga de la membrana, la onda mecánica consecuente (o causal), etc, ya que en algunos casos ni siquiera se entiende bien su naturaleza; este trabajo se remite a electrostática de proteínas totalmente embebidas en la membrana.\\\\
El presente texto busca entonces \textit{presentar la física que hay tras una interacción electrostática en medios dieléctricos, trabajando un método que permita modelar una membrana celular a partir de un sistema de tres medios separados por dos interfaces, con cargas distribuidas en el medio encerrado. Teniendo este modelo, se lo implementa en un código y se procede a la comparación con programas ya reconocidos}.
%Sumado a esto se presentan resúmenes de publicaciones relevantes para la línea de estudio pertinente a este escrito, y que incluso podrían servir para mejorar la precisión del modelo al representar de manera más fiel la física de las interacciones de interés, al sumar otro tipo de interacciones o fenómenos, o al plantear respuestas a interrogantes que pudieran surgir en un futuro.\\\\
En primer lugar se presenta una introducción a la teoría que permite trabajar los sistemas dieléctricos con interfaz de forma macroscópica y mediante el método de imágenes. También se echa un vistazo a la formulación que da pie al método BEM, la denominada Boundary Integral Equation de un sistema de ecuaciones diferencial, además de contextualizar sobre aspectos básicos de la membrana para entender qué es lo que se busca. A continuación se presenta un ejemplo de formulación integral de frontera con el caso de la ecuación de Poisson - Boltzmann, que no se trabaja directamente en esta investigación, pero que va de la mano con la metodología de solvente implícito; además, en el caso de no haber una distribución de iones ($\kappa = 0$), se recupera una ecuación de Laplace, la que si se utiliza en este trabajo. Junto a esto, se describen los programas relevantes para lograr los objetivos planteados. Entrando a la parte fundamental de esta investigación, se desarrolla el método de imágenes para un sistema con dos interfaces paralelas, y cómo se incluye en la formulación, además de su implementación al programa \texttt{PyGBe}. Por último, se presentan los resultados obtenidos y cómo se comparan con los de programas como \texttt{APBS - APBSmem}; esto considera también la forma en que influye la variación del número de cargas del método de imágenes en el resultado. Tras tener estos resultados se termina presentando las conclusiones extraídas de este trabajo.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Marco Teórico}\label{Chap:Teoria}
\section{El campo eléctrico y el potencial eléctrico}\label{Sec:E_field_Pot_elec}
El campo eléctrico correspondiente a una carga puntual $q$ que se encuentra en el vacío en la posición $\mathbf{r}_0$ viene dado por la conocida ecuación
\begin{equation}\label{eqn:charge_field}
\vec{E}(\mathbf{r}) = \frac{q}{4\pi\varepsilon_0}\frac{(\mathbf{r} - \mathbf{r}_0)}{|\mathbf{r}-\mathbf{r}_0|^3}
\end{equation}
siendo $\varepsilon_0$ la permitividad macroscópica del vacío, una medida de cómo fluye el campo eléctrico en el vacío. Por supuesto, en el caso ejemplificado en la ecuación (\ref{eqn:charge_field}), no hay un medio que reaccione, por lo que $\varepsilon_0$ se toma como referencia. De ahora en adelante se trabaja con $\varepsilon$ propio de un dieléctrico; además se elabora más sobre la permitividad en la sección siguiente.\\\\
Cuando se cuenta con N cargas puntuales, la ecuación (\ref{eqn:charge_field}) se convierte en una sumatoria sobre todos los elementos del sistema de cargas a considerar
\begin{equation}\label{eqn:electric_field_sum}
\vec{E}(\mathbf{r}) = \sum_{j=1}^{N_q}\frac{q_j}{4\pi\varepsilon}\frac{(\mathbf{r} - \mathbf{r}_j)}{|\mathbf{r}-\mathbf{r}_j|^3}
\end{equation}
Para un caso con una distribución continua de carga, se define el flujo de campo eléctrico a través de una superficie que encierra toda la distribución de carga como
\begin{equation}
\int_{\partial\Omega}\vec{E}(\mathbf{r})\cdot \hat{\mathbf{n}}\, d\partial\Omega = \int_{\Omega} \frac{\rho}{\varepsilon}\, d\Omega \label{eqn:Gauss_law_int}
\end{equation}
Esta es la ley de Gauss en forma integral. Con el teorema de la divergencia aplicado a la ecuación (\ref{eqn:Gauss_law_int}) se llega a la ley de Gauss en forma diferencial:

\begin{equation}
\int_{\Omega} \nabla\cdot\vec{E} \, d\Omega = \int_\Omega \frac{\rho}{\varepsilon}\, d\Omega \quad\implies\quad \nabla\cdot\vec{E} = \frac{\rho}{\varepsilon} \label{eqn:Gauss_law_diff}
\end{equation}
\noindent
Por otro lado, como el campo eléctrico es un campo vectorial irrotacional, se puede aplicar el teorema fundamental del cálculo para obtener su función potencial. Como $\vec{E}(\mathbf{r})$ es una variable solo de la diferencia de posiciones entre la de la carga y el punto de evaluación $|\mathbf{r} - \mathbf{r}_0|$ (función solo del radio), la integración es directa si la referencia para el potencial eléctrico se toma como $0$ al infinito, quedando

\begin{align*}\label{eqn:potential}
\vec{E} = \nabla\phi \quad\rightarrow\quad\phi{(\mathbf{r})} = -\int_\infty^{\mathbf{r}} \vec{E}(\mathbf{r}^*)\, d\mathbf{r}^* &\\
 = -\int_\infty^{\mathbf{r}} \frac{q}{4\pi\varepsilon}\frac{(\mathbf{r}^*-\mathbf{r}_0)}{|\mathbf{r}^* - \mathbf{r}_0|^3}\, d\mathbf{r}^*& = \frac{q}{4\pi\varepsilon}\frac{1}{|\mathbf{r} - \mathbf{r}_0|}\numberthis
\end{align*}
\noindent
Esto es en los casos en que se tenga una carga puntual, haciendo el paralelo con la ecuación (\ref{eqn:charge_field}). Para una carga distribuida se debe considerar la ecuación (\ref{eqn:Gauss_law_int}), y siguiendo la misma lógica se llega a

\begin{equation}\label{eqn:integral_potential}
\phi(\mathbf{r}) = \int_\Omega \frac{\rho(\mathbf{r}_0)}{4\pi\varepsilon}\frac{1}{|\mathbf{r}-\mathbf{r}_0|}d\Omega
\end{equation}
\noindent
En los casos en que el medio en el que está la carga $q$ no sea el vacío, se debe considerar que la materia que lo compone si reaccionará al campo eléctrico asociado a $q$; en estos casos, $\varepsilon \neq \varepsilon_0$. Es decir, hay que aclarar que las ecuaciones (\ref{eqn:Gauss_law_int}) y (\ref{eqn:Gauss_law_diff}) no están completas, pues falta considerar el efecto de la \textit{polarización}. Además resulta interesante entender qué es realmente la permitividad, que está relacionada directamente con la polarización del medio; a continuación se explican estos puntos.

\section{La permitividad de un medio material, la polarización y el campo eléctrico microscópico}\label{Sec:perm_polarization_mic_E_field}
Se puede entender la constante dieléctrica de un material (o permitividad) como una medida del reordenamiento de las partículas de un medio a nivel molecular frente a la presencia de un campo eléctrico externo, y provocando así que dichas partículas generen un \textit{campo eléctrico inducido}, que es opuesto en sentido al original, pero no necesariamente de la misma intensidad; este disminuye el flujo neto del campo eléctrico externo, por lo que impide en cierta medida su paso, dando su nombre a la propiedad - en qué grado los átomos del material \textbf{permiten} el flujo de campo eléctrico.\\\\
La permitividad que se utiliza en las ecuaciones (\ref{eqn:charge_field} - \ref{eqn:integral_potential}) es llamada también \textit{constante dieléctrica} del medio, y en realidad es un concepto derivado de la susceptibilidad eléctrica y de lo que ocurre a nivel molecular en el medio dieléctrico afectado por un campo eléctrico. En el caso del vacío se menciona que no existe un medio que reaccione a la presencia de una carga (y por ende no ``siente" el campo eléctrico), por lo que la constante dieléctrica del vacío es considerada como referencia. Por el contrario, en un dieléctrico si se tiene una reacción al campo eléctrico; en este caso es importante explicar qué pasa con el campo eléctrico a nivel microscópico y cómo eso se relaciona con la susceptibilidad eléctrica. Los términos microscópico y local se utilizan indistintamente \cite{Kantorovich}.

\subsection{Campo eléctrico local y polarización}\label{subsec:Local_Field}
\begin{figure}[h]
\centering
\input{./Figures/Fig_1.eps_tex}
\caption{Efecto de un campo sobre la forma de un átomo. El electrón (en realidad la nube electrónica) es ``halado" por el campo, mientras que el protón (o núcleo atómico) es ``empujado", induciendo así un dipolo.}
\label{fig:Polarization}
\end{figure}
\noindent
Cuando se aplica un campo eléctrico externo a un cuerpo o medio (macroscópico) dieléctrico, las partículas constituyentes de los átomos se comportan de forma especial. Por ejemplo, en la figura \ref{fig:Polarization} se muestra un átomo simple de hidrógeno que se reordena bajo la acción de un campo externo que rompe el equilibrio eléctrico del átomo, generando así un campo eléctrico opuesto con líneas de campo (inducido) que van del protón hacia el electrón (se representa la nube electrónica con un solo electrón por simplicidad). Este efecto es la polarización, e induce un momento dipolar $\mathbf{p}$ en los átomos afectados por el campo eléctrico a nivel local.

\begin{equation}
\mathbf{p} = \alpha\vec{E}^{loc}
\end{equation}
\noindent
$\alpha$ se conoce como la polarizabilidad microscópica, un coeficiente de proporcionalidad que representa qué tanto se polariza la especie analizada - la magnitud del momento dipolar inducido - en presencia de un cierto campo eléctrico local $\vec{E}^{loc}$. Por supuesto, esta es una relación constitutiva, porque $\alpha$ depende del material o elemento estudiado. Ahora se hace la distinción entre los distintos campos eléctricos de interés para este apartado:
\begin{gather*}
\vec{E}^{ext} \quad \longrightarrow \quad \text{Campo eléctrico externo}\\
\vec{E}^{loc} \quad \longrightarrow \quad \text{Campo eléctrico local}\\
\vec{E}^{ind} \quad \longrightarrow \quad \text{Campo eléctrico inducido (microscópico)}\\
\vec{E} \quad \longrightarrow \quad \text{Campo eléctrico macroscópico}
\end{gather*}
\noindent
y se define la relación entre los primeros tres como

\begin{equation}
\vec{E}^{loc} = \vec{E}^{ind} + \vec{E}^{ext}
\end{equation}
\noindent
Es conveniente explicar que si bien se define uno de los campos como microscópico o local, esto no es el campo debido a un único átomo o molécula, sino el propio de un volumen macroscópicamente pequeño pero microscópicamente grande; por lo tanto, los términos local y microscópico son en realidad promedios sobre volúmenes más pequeños que el campo de las ecuaciones de Maxwell. Hay que notar también que si el campo eléctrico se transmite por el vacío, $\vec{E}^{ind} = 0$, y por ende $\vec{E}^{ext} = \vec{E}^{loc} = \vec{E}$. No se entra en detalle respecto al álgebra pues existen referencias sobre el tema, como por ejemplo el texto de Kantorovich \cite{Kantorovich}, pero después de algo de trabajo se llega a la expresión para el campo eléctrico local, también llamado campo de Lorentz, en función del campo macroscópico

\begin{equation}
\vec{E}^{loc} = \vec{E}(1 + \kappa)\label{eqn:Local_Field}
\end{equation}
\noindent
donde $\kappa$ es un factor de corrección que depende del ordenamiento microscópico. El campo eléctrico local es el campo que siente cada uno de los muchos volúmenes pequeños que, en conjunto, componen el medio macroscópico que se esta estudiando. Por último se presenta la definición de densidad de polarización $\vec{P}$ para cerrar el círculo de relaciones entre el dieléctrico estudiado a nivel macroscópico y microscópico. La densidad de polarización por unidad de volumen se define de dos maneras; esto sale de diversas fuentes, pero W. Cai \cite{Cai} lo resume todo de forma simple:

\begin{gather}
\vec{P}(\mathbf{r}) = \sum_i n_i\alpha_i\left[\vec{E}(\mathbf{r})^{loc}\right]_i = \sum_i n_i\mathbf{p}_i\label{eqn:Micro_Polarization_sumation}\\
\vec{P}(\mathbf{r}) = \varepsilon_0\chi\vec{E}(\mathbf{r})\label{eqn:Macro_Polarization}
\end{gather}
\noindent
con $n_i$ la densidad numérica (\textit{number density}) del $i$-ésimo átomo por unidad de volumen, y $\chi$ la susceptibilidad del medio dieléctrico (que en el caso del vacío es 0). Antes de continuar el desarrollo, se procede a definir qué son la densidad de polarización y la susceptibilidad.\\\\
Como concepto, la densidad de polarización es la polarización a nivel macroscópico, por unidad de volumen, causada por todos los momentos dipolares inducidos en las moléculas de dicho volumen asociados al campo eléctrico que los induce. Por otra parte, la susceptibilidad permite relacionar un campo eléctrico macroscópico con los efectos que este tiene en el momento dipolar de las partículas en un volumen a través de la densidad de polarización, como se indica en la ecuación \ref{eqn:Macro_Polarization}; más allá de ser una constante de proporcionalidad, la susceptibilidad indica de forma promediada cómo influye el campo eléctrico en la orientación de los dipolos, y cómo varía el momento dipolar del medio a nivel macroscópico en presencia del campo eléctrico. Hay que resaltar que esto no implica traslación o \textit{migración} electrónica, sino solo rotación del átomo o molécula para la reorientación del dipolo, intentando alinearlo con el campo.\\\\
Para terminar esta parte del desarrollo teórico, de las ecuaciones (\ref{eqn:Local_Field} - \ref{eqn:Macro_Polarization}) y sabiendo que el campo macroscópico es el mismo, se puede deducir que

\begin{align*}
\vec{P}(\mathbf{r}) &= \varepsilon_0\chi\vec{E}(\mathbf{r}) = \vec{E}(\mathbf{r})\sum_in_i\alpha_i(1+\kappa_i)\\
&\implies\quad \varepsilon_0\chi = \sum_in_i\alpha_i(1+\kappa_i) \numberthis
\end{align*}
\noindent
Un caso particular es la teoría de Clausius-Mossotti. Aquí el valor de $\kappa_i = \kappa$ es $\chi/3$; uno de los supuestos es que la distribución molecular es una malla cúbica regular.\\\\
Con esto se puede entender de manera general cómo se relacionan el campo eléctrico macroscópico y microscópico. El propósito de este apartado es simplemente aclarar que ambos análisis no son independientes y que el tratamiento de continuo que se ve en lo sucesivo está fundamentado en teoría del comportamiento eléctrico molecular; es por esto que se omiten pasos y solo se presentan resultados que se consideran importantes.

\subsection{Permitividad de un medio macroscópico}\label{subsec:Macro_perm}
Ya se explicó qué son la susceptibilidad y densidad de polarización, por lo que se procede a definir un poco mejor qué es la permitividad, profundizando en lo que se mencionó al principio de la sección \ref{Sec:perm_polarization_mic_E_field}.
%\begin{figure}
%\centering
%\includegraphics[scale=]{•}
%\caption{}
%\end{figure}
Primero corresponde aclarar que la permitividad es netamente una propiedad macroscópica del medio, pero se prefiere caer en la redundancia un par de veces, como en el caso del título de esta sección, para reafirmar este punto. Cuando un campo eléctrico afecta un medio dieléctrico, los dipolos no solo se intentan alinear con las líneas de campo, sino que además hay un \textit{movimiento de cargas libres} dentro del cuerpo. Sumado a esto está el hecho de que los átomos conformantes del medio rompen el estado de equilibrio, pues los protones son repelidos por el campo, mientras que los electrones son atraídos por este (figura \ref{fig:Polarization}). Dicho efecto genera que se formen nuevos dipolos y en consecuencia que haya un momento dipolar distinto al original en el medio; es por esta razón que la susceptibilidad se relaciona con la permitividad. Teniendo presentes los fenómenos recién nombrados, se reitera la definición de permitividad o constante dieléctrica como una cuantificación macroscópica promedio de la tendencia de un medio (en este caso un dieléctrico) a oponerse al flujo de campo eléctrico por alguno de los mecanismos nombrados anteriormente.\\\\
Existen tres \textit{permitividades} de interés para este desarrollo: la permitividad del vacío $\varepsilon_0$, la permitividad propia de un material $\varepsilon$, y la permitividad relativa o constante dieléctrica, a la que en este caso se da más importancia

\begin{equation}\label{eqn:Permittivity_definition}
\varepsilon_r = \frac{\varepsilon}{\varepsilon_0}=\varepsilon_0(1+\chi)
\end{equation}
\noindent
(llamada $k$ en algunas fuentes). De ahora en adelante, $\varepsilon$ a secas pasa a ser la permitividad relativa y se denomina simplemente \textit{permitividad} o \textit{constante dieléctrica} de un medio.\footnote{En estricto rigor, la constante dieléctrica es $\varepsilon_r\cdot\varepsilon_0$, pero por costumbre se utiliza este término para referirse a la propiedad adimensional en este informe.}
\section{Desplazamiento eléctrico y campo eléctrico en un medio dieléctrico}\label{Sec:Elec_Displacement}
En lo sucesivo, todo el trabajo es relativo a un medio o campo macroscópico. En este informe no se trabaja directamente con los momentos dipolares, la susceptibilidad, o incluso con la densidad de polarización, sino que se presenta una sola ecuación que engloba todos los efectos de un campo eléctrico sobre un dieléctrico; para llegar a dicha ecuación se utilizan las relaciones ya introducidas y un par de definiciones nuevas.\\\\
La ecuación (\ref{eqn:Macro_Polarization}) es una expresión que asocia el campo eléctrico y la densidad de polarización, establecida a través de la susceptibilidad y la permitividad. Además, la ecuación (\ref{eqn:Gauss_law_int}) es la ley de Gauss para una distribución de carga, que tiene que ver únicamente con la permitividad.\\\\
Si se asume que el flujo de campo eléctrico se debe a contribuciones de la distribución de carga y de la polarización del medio únicamente, entonces se puede expresar dicho flujo de campo eléctrico como
\begin{equation}\label{eqn:Field_pol_rho_relation}
\nabla\cdot\vec{E} = \frac{\rho - \nabla\cdot\vec{P}}{\varepsilon_0}
\end{equation}
\noindent
Se define entonces el \textit{desplazamiento eléctrico} como
\begin{equation}\label{eqn:Electric_Displacement}
\vec{D} = \vec{E} + \vec{P} = \varepsilon_0\vec{E}(1 + \chi)
\end{equation}
\noindent
lo que permite escribir la ecuación (\ref{eqn:Field_pol_rho_relation}) como
\begin{equation}
\nabla\cdot\vec{D} = \rho
\end{equation}
\noindent
Esto corresponde al efecto completo del flujo de campo eléctrico sobre el medio. En general, en la ecuación (\ref{eqn:Electric_Displacement}) se asocia el campo eléctrico $\vec{E}$ a las cargas libres (free charges) y la densidad de polarización $\vec{P}$ a las cargas fijas (bound charges), pero para el objetivo de este texto eso no es relevante.\\\\
Siguiendo con la idea, recordando que ahora $\varepsilon_r = \varepsilon$ y suponiendo que la permitividad es una propiedad isotrópica, al usar la ecuación (\ref{eqn:Permittivity_definition}) en (\ref{eqn:Electric_Displacement}), se puede obtener
\begin{align*}
\vec{D} = \varepsilon\vec{E}\quad\biggm/&\nabla\cdot\\
\rightarrow\quad&\nabla\cdot\vec{D}=\nabla\cdot(\varepsilon\vec{E}) = \nabla(\varepsilon)\cdot\vec{E} + \varepsilon\nabla\cdot\vec{E} = \rho \numberthis
\end{align*}
Aún más, si la permitividad del medio es constante sobre el mismo, entonces el término $\nabla (\varepsilon)\cdot\vec{E}$ se anula. Es así que se retorna a la ecuación de la que prácticamente parte el desarrollo de la teoría, la ley de Gauss.
\begin{equation}
\nabla\cdot\vec{E} = \frac{\rho}{\varepsilon} \qquad \iff \qquad \nabla^2\phi = \frac{\rho}{\varepsilon} \label{eqn:Laplace_potential}
\end{equation}
El gran progreso es haber demostrado que (\ref{eqn:Gauss_law_diff}) no solo sirve para calcular el campo eléctrico en el vacío, sino que se puede aplicar a los dieléctricos en general y que incluso se consideran los efectos de polarización inducidos.

\section{Método de imágenes}\label{Sec:Image_Method}
En la teoría electrostática hay ocasiones en que hay que trabajar con interfaces que separan distintos medios dieléctricos. El método de imágenes destaca por su simpleza en este tipo de escenarios. La idea es que cargas en un medio inducirán un campo opuesto en el otro, el denominado campo de reacción. A su vez este campo inducido afectará al campo en el primer medio, por lo que hay que encontrar una expresión para el comportamiento de los campos eléctricos en los dos medios; por supuesto, este problema no se soluciona simplemente con aplicar la ecuación (\ref{eqn:charge_field}) una vez.\\\\
El método de imágenes facilita la resolución del problema de una forma simple: En vez de considerar la polarización y el consecuente campo inducido por el segundo medio como un todo, se hace más fácil poner una carga o distribución de cargas imágenes (puede ser incluso una distribución continua) de tal forma que el efecto de dicha carga sobre el primer medio sea el mismo que si hubiera un campo de reacción. Para esto uno analiza los distintos medios por separado en vez de como un sistema.\\\\
Como la interfaz es un límite para el espacio de análisis, es aquí donde se establecen las condiciones de frontera. Para un sistema de coordenadas adecuado al problema, existen condiciones para la componente normal del campo y para su componente tangencial justo en la interfaz. Matemáticamente esto es
\begin{gather}
\varepsilon_1\vec{E}_1\cdot\hat{\mathbf{n}} = \varepsilon_2\vec{E}_2\cdot\hat{\mathbf{n}} \label{eqn:jump_condition}\\
\vec{E}_1\cdot\hat{\mathbf{t}} = \vec{E}_2\cdot\hat{\mathbf{t}} \label{eqn:pot_continuity}
\end{gather}
En este caso, $\hat{\mathbf{n}}$ es un vector normal a la superficie interfaz, y $\hat{\mathbf{t}}$ un vector tangencial a la misma. En palabras, las ecuaciones (\ref{eqn:jump_condition}) y (\ref{eqn:pot_continuity}) indican que hay un cambio en la componente normal del campo igual a $\varepsilon_1/\varepsilon_2$; esto es, hay un salto en la componente normal. Como ejemplo se tiene el caso más simple, con dos dieléctricos homogéneos isotrópicos ($\varepsilon = cte$) en la figura \ref{Fig:Fig_2}. Hay que notar que, como se dijo, al trabajar de esta forma se analizan los medios por separado, y se debe considerar el efecto de la carga imagen que representa el campo de reacción solo en el medio 1. La idea es determinar qué valor tiene que tener la carga o conjunto de cargas necesarias, que pueden ser continuas o discretas, en función de los parámetros que si se conocen en el sistema. En el caso particular de que la interfaz sea una placa cargada de espesor infinitesimal y los medios a analizar tengan la misma constante dieléctrica, se llega al resultado elemental de un salto (discontinuidad) en la componente normal del campo eléctrico dado por
\begin{equation}
(\vec{E}_2 - \vec{E}_1)\cdot\hat{\mathbf{n}} = \frac{\sigma}{\varepsilon_m}
\end{equation}
con $\sigma$ la densidad superficial de carga y $\varepsilon_m$ la constante dieléctrica de los medios que rodean al plano. \\\\
Se desarrolla más a cabalidad el tema en secciones posteriores, ya que forma parte del problema clave que motiva este escrito. Se presenta un desarrollo del caso planteado con el sistema de ecuaciones, y se analiza un sistema con dos interfaces paralelas, todo mediante el método de imágenes. 
\begin{figure}[h]
	\centering
	\input{./Figures/Fig_2.eps_tex}
	\caption{Se observan las líneas de desplazamiento eléctrico, que dan cuenta del efecto de la polarización.}\label{Fig:Fig_2}
\end{figure}
\noindent
\subsection{Campo de reacción en un sistema con una interfaz y una carga puntual}\label{subsec:Reaction_Field}
En primer lugar se tiene un caso simple, presente en la mayoría de los libros de electrodinámica, que consiste en una carga en un medio 1 y una interfaz que separa a este último de un medio 2; el caso en cuestión se presenta en la figura \ref{Fig:Fig_3}. El campo eléctrico viene dado por la ecuación (\ref{eqn:charge_field}), y tiene como condiciones de contorno las presentadas en las Ecs. (\ref{eqn:jump_condition}) y (\ref{eqn:pot_continuity}).
El potencial en algún punto $P$ en el medio 1 viene dado por el potencial de una carga $q$ real y la carga imagen $q_1$, que representa el campo de reacción del medio 2 a causa de $q$. Además el potencial en el medio 2 ya no es debido únicamente a la carga $q$, pues el medio dieléctrico reacciona; esto se representa por una nueva carga imagen $q_2$. En este caso, $R_{\substack{1\\(2)}} = \sqrt{r^2 + (z \varpm d)^2}$, el signo dependiendo de si la carga, ya sea imaginaria o real, esta hacia la izquierda o derecha del plano $z=0$.
\begin{figure}[h]
	\centering
	\input{./Figures/Fig_3.eps_tex}
	\caption{Sistema de una carga real y dos imaginarias para representar el campo de reacción, con el cambio de medio en $z=0$. Se consideran dos espacios semi-infinitos a partir de este plano.}\label{Fig:Fig_3}
\end{figure}
\noindent
No es complejo realizar el desarrollo, remplazando la expresión para el campo en las condiciones de contorno. Con un poco de álgebra se puede llegar a una forma de escribir las cargas $q_1$ y $q_2$ en función de la carga $q$, así como de las permitividades de los medios. Se muestra a continuación un paso a paso breve de cómo se resuelve el sistema. Si $\phi_1$ es el potencial para algún punto en el medio 1, y $\phi_2$ es el potencial en el medio 2, se tiene

\begin{gather}
\phi_1 = \frac{1}{4\pi\varepsilon_1}\left(\frac{q}{\sqrt{r^2+(z-d)^2}}+\frac{q_1}{\sqrt{r^2+(z+d)^2}}\right)\label{eqn:potential_system_image_method_1}\\
\phi_2 = \frac{1}{4\pi\varepsilon_2}\left(\frac{q_2}{\sqrt{r^2+(z-d)^2}}\right)\label{eqn:potential_system_image_method_2}
\end{gather}
Derivando estas expresiones y remplazándolas en la condición de contorno (\ref{eqn:jump_condition}) se obtiene el siguiente sistema de ecuaciones $2\times 2$\\
%\begin{gather*}
%\epsilon_1\lim\limits_{z\to 0^-}\vec{E}_{(r,z)}= \epsilon_2\lim\limits_{z\to 0^+}\vec{E}_{(r,z)} \quad \longrightarrow \quad \epsilon_1\left.\frac{\partial\phi}{\partial z}\right|_{z = 0^-} = \epsilon_2\left.\frac{\partial\phi}{\partial z}\right|_{z = 0^+}\\
%\implies \epsilon_1\frac{q}{\cancel{4\pi}\epsilon_2}\left.\frac{1}{\sqrt{r^2 + (z-d)^2}}\right|_{z=0}=\frac{q}{\cancel{4\pi}}\left.\frac{1}{\sqrt{r^2 + (z+d)^2}}\right|_{z=0}
%\end{gather*}
\begin{align*}
\frac{\partial}{\partial z}\left[\bcancel{\varepsilon_1}\cdot\left(\frac{q}{\cancel{4\pi}\bcancel{\varepsilon_1}}\cdot\frac{1}{\sqrt{r^2+(z-d)^2}}+\frac{q_1}{\cancel{4\pi}\bcancel{\varepsilon_1}}\frac{1}{\sqrt{r^2 + (z+d)^2}}\right)\right]_{z = 0} &=\\ \frac{\partial}{\partial z}\left[\bcancel{\varepsilon_2}\cdot\left(\frac{q_2}{\cancel{4\pi}\bcancel{\varepsilon_2}}\frac{1}{\sqrt{r^2 + (z-d)^2}}\right)\right]_{z=0}\quad\implies&\\
d\cdot\left(\frac{q}{\sqrt{(r^2 + (-d)^2)^3}} - \frac{q_1}{\sqrt{(r^2 + d^2)^3}}\right) = d\cdot\left(\frac{q_2}{\sqrt{(r^2 + (-d)^2)^3}}\right)
\end{align*}
\begin{equation}\label{eqn:image_system_eq1}
\implies \qquad q - q_1 = q_2
\end{equation}
Para el caso de la condición de contorno (\ref{eqn:pot_continuity}) se remplazan también las expresiones de $\partial_r\phi_1$ y $\partial_r\phi_2$, pero en este caso no se simplifican las permitividades, por lo que se llega a una expresión que las incluye:
\begin{gather*}
\frac{\partial}{\partial r}\left(\frac{q}{\cancel{4\pi}\varepsilon_1}\frac{1}{\sqrt{r^2 + (z-d)^2}} + \frac{q_1}{\cancel{4\pi}\varepsilon_1}\frac{1}{\sqrt{r^2 + (z+d)^2}}\right)_{z=0} =\\
\frac{\partial}{\partial r}\left(\frac{q_2}{\cancel{4\pi}\varepsilon_2}\frac{1}{\sqrt{r^2 + (z-d)^2}}\right)_{z=0}\quad\implies\\
\frac{r}{\varepsilon_1}\cdot\left(\frac{q}{\sqrt{(r^2 + (-d)^2)^3}}+ \frac{q_1}{\sqrt{(r^2 + d^2)}}\right) = \frac{r}{\varepsilon_2}\cdot\left(\frac{q_2}{\sqrt{(r^2 + (-d)^2)^3}}\right)
\end{gather*}
\begin{equation}\label{eqn:image_system_eq2}
\implies \frac{1}{\varepsilon_1}(q + q_1) = \frac{q_2}{\varepsilon_2}
\end{equation}
Ahora, del sistema que conforman las ecuaciones (\ref{eqn:image_system_eq1}) y (\ref{eqn:image_system_eq2}), se obtiene la expresión para las cargas imagen en función de los parámetros conocidos del sistema:
\begin{gather}
q_1 = -\left(\frac{\varepsilon_2 - \varepsilon_1}{\varepsilon_2 + \varepsilon_1}\right)\cdot q \label{eqn:image_q_1}\\
q_2 = \left(\frac{2\varepsilon_2}{\varepsilon_1 + \varepsilon_2}\right)\cdot q \label{eqn:image_q_2}
\end{gather}
Luego, el potencial en cualquier punto en el espacio se trabaja dependiendo de en qué medio se ubica dicho punto, y para calcular su valor se utilizan las ecuaciones (\ref{eqn:potential_system_image_method_1}) y (\ref{eqn:potential_system_image_method_2}) dependiendo de dónde se encuentra; por supuesto, esto remplazando $q_1$ y $q_2$ por sus valores de las ecuaciones (\ref{eqn:image_q_1}) y (\ref{eqn:image_q_2}).

\section{El Método de Elementos de Borde}\label{Sec:BEM_theory}
Previamente ya se mencionó el uso del método de elementos de borde (BEM) para aplicar el modelo derivado del método de imágenes para membranas. El método BEM actúa partiendo del mismo principio de debilitar una ecuación diferencial que el método de elementos finitos FEM, pero en este caso la discretización no ocurre sobre el dominio de integración de la ecuación diferencial, sino sobre su contorno.\\\\
El método comienza tomando la formulación débil de una ecuación diferencial. En este caso se utiliza la ecuación de Laplace, multiplicada por una función $\psi$ tal que

\begin{equation*}
\int\nabla^2 \phi\cdot\psi = 0
\end{equation*}
Con esto como punto de partida, se procede a debilitar la ecuación de Laplace, integrando por partes
\begin{equation*}
\int_\Omega \nabla^2\phi\cdot\psi\, d\Omega = \int_\Omega \nabla(\nabla \phi\cdot\psi) - \nabla\phi\cdot\nabla\psi\, d\Omega = 0
\end{equation*}
Respecto al integrando del lado derecho, si se aplica el teorema de la divergencia al primer término y se integra por partes el segundo, se llega a
\begin{equation*}
\int_{\partial\Omega} (\nabla\phi\cdot\psi)\cdot\hat{\mathbf{n}}\, d\partial\Omega - \int_\Omega [\nabla\cdot(\nabla\psi\cdot\phi) - \nabla^2\psi\cdot\phi]\, d\Omega = 0
\end{equation*}
A continuación, al aplicar nuevamente el teorema de la divergencia al primer término de la segunda integral, se obtienen dos integrales de superficie y una de volumen.
\begin{equation}\label{eqn:BIE_BEM}
\int_{\partial\Omega} (\nabla\phi\cdot\psi - \nabla\psi\cdot\phi) \cdot\hat{\mathbf{n}}\, d\partial\Omega = -\int_\Omega \phi\cdot\nabla^2\psi\, d\Omega
\end{equation}
Si en particular $\nabla^2\psi$ corresponde a una función delta de Dirac ($\delta(\mathbf{r})$), entonces la integral del lado derecho es $\phi$ evaluado en los puntos seleccionados por la función $\delta$. Para que se cumpla $\nabla^2\psi = -\delta(\mathbf{r}^*)$, $\psi$ debe ser una función de Green
\begin{equation}\label{eqn:Dirac_delta}
\psi = G(\mathbf{r},\mathbf{r}^*) = \frac{k}{|\mathbf{r} - \mathbf{r}^*|}
\end{equation}
donde $k$ es una constante que no afecta la proporcionalidad inversa respecto del radio. Aquí $\mathbf{r} = \mathbf{r}_\Omega$ y $\mathbf{r}^* = \mathbf{r}_\Omega^*$, significando que ambos corren sobre el mismo dominio de integración, pero son independientes uno del otro. De esta manera, utilizando una función como la (\ref{eqn:Dirac_delta}), la ecuación (\ref{eqn:BIE_BEM}) queda con la forma final
\begin{align*}
\int_\Omega\phi(\mathbf{r}_\Omega)\delta(\mathbf{r}_\Omega^*)\, d\Omega=&\\
\phi(\mathbf{r}_\Omega^*)=&\int_{\partial\Omega}\left[\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r}_{\partial\Omega})\cdot \right.G(\mathbf{r}_\Omega,\mathbf{r}_{\partial\Omega})\, -\\ &\left.\frac{\partial}{\partial\hat{\mathbf{n}}}G(\mathbf{r}_\Omega,\mathbf{r}_{\partial\Omega})\cdot\phi(\mathbf{r}_{\partial\Omega})\right]\, d\partial\Omega \numberthis \label{eqn:BEM_equation}
\end{align*}
En los casos en que se produzca una singularidad debido a que $\mathbf{r}_\Omega \rightarrow \mathbf{r}_{\partial\Omega}$, los valores de las integrales de superficie son
\begin{gather}
\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}\phi\cdot G = 0 \label{eqn:BEM_condition_1} \\
\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}} G\cdot\phi = -\frac{\phi}{2} \label{eqn:BEM_condition_2}
\end{gather}
En este escrito se omite la demostración correspondiente debido a que no se considera relevante más allá del resultado, pero un desarrollo metódico se puede encontrar en textos de la materia, como por ejemplo el libro de Brebbia \cite{Brebbia}.\\\\
En síntesis, la ecuación (\ref{eqn:BEM_equation}) permite obtener $\phi$ en el dominio $\Omega$ contenido por una superficie $\partial\Omega$; por otro lado, para calcular $\phi$ sobre el contorno $\partial\Omega$, se aplican los resultados (\ref{eqn:BEM_condition_1}) y (\ref{eqn:BEM_condition_2}) en la ecuación (\ref{eqn:BEM_equation}) y se obtiene
\begin{align*}
\frac{\phi(\mathbf{r}_{\partial\Omega})}{2} = \int_{\partial\Omega}\left[\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r}_{\partial\Omega})\cdot \right.G(\mathbf{r}_{\partial\Omega},\mathbf{r}_{\partial\Omega}^*) \,&-  \\ \left.\frac{\partial}{\partial\hat{\mathbf{n}}}G(\mathbf{r}_{\partial\Omega},\mathbf{r}_{\partial\Omega}^*)\cdot\phi(\mathbf{r}_\Omega)\right]&\,d\partial\Omega \numberthis
\end{align*}
En ambos casos ($\mathbf{r}_{\partial\Omega}$ y $\mathbf{r}_{\partial\Omega}^*$) la aplicación es sobre la misma superficie $\partial\Omega$. Es importante considerar que la formulación de la Boundary Integral Equation (BIE) que se ha hecho hasta ahora es para la ecuación de Laplace en 3D. En caso de que la ecuación gobernante del fenómeno bajo estudio sea otra, corresponde hacer una derivación para dicha situación. Afortunadamente, para lo desarrollado en el presente texto no hace falta más.


\section{El contexto biológico de la membrana celular}\label{Sec:Cell_Bio}
A pesar de haber mencionado la teoría sobre el comportamiento de cargas en un medio, el método de imágenes, y el método BEM que permite llevar todo esto a aplicaciones numéricas, estos pueden aún parecer tópicos un tanto aislados unos de otros, e incluso abstractos en cierta medida. Como consecuencia se presenta el contexto biológico que motiva la búsqueda de un modelo para integrar el efecto de la membrana celular en el que se encuentran insertas algunas proteínas.\\\\
Una célula se compone de distintas estructuras funcionales que permiten transformar moléculas en energía, enviar y recibir señales de tipo químico y eléctrico, permitir el paso de compuestos desde y hacia el exterior de la célula, entre otros. Las proteínas son probablemente el tipo de macromolécula con la mayor diversidad de funciones en el entorno celular, y su importancia en el quehacer de la membrana, sea este el flujo de elementos o la conducción de señales, por ejemplo, es fundamental. La membrana plasmática se compone de una cadena de fosfolípidos, uno al lado del otro, que rodean el citoplasma (fluido intracelular) y separan el interior de la célula, con estructuras y todo, del fluido extracelular. Más aún, la membrana celular, también llamada bicapa fosfolipídica debido a su composición, es la encargada de definir la frontera de ciertos organelos de la célula; las lisosomas, mitocondrias y el mismo núcleo celular son algunos.\\\\
Los fosfolípidos son un tipo de molécula conformado por dos ``colas" de ácidos grasos que se unen a un glicerol. Para completar la molécula, también hay un fosfato enlazado al glicerol, que lleva por el lado opuesto una unión con un grupo de carácter polar. Para efectos de este trabajo, lo que hay que rescatar es el hecho de que las colas son hidrófobas, mientras que la ``cabeza" conformada por el glicerol, el fosfato y el compuesto polar - generalmente una colina - son la parte hidrófila del fosfolípido. La figura \ref{Fig:Fig_5-2} muestra una sección de la membrana, mientras que la figura \ref{Fig:Fig_5} corresponde al detalle de un fosfolípido.

\begin{figure}[h]
	\centering
	\input{./Figures/Fig_5-2.eps_tex}
	\caption{Tramo de la bicapa con proteína inserta. Esta última se orienta de tal forma que la parte hidrofílica (polar) quede en contacto con el agua en el exterior, de igual forma que las cabezas de los fosfolípidos.} \label{Fig:Fig_5-2}
\end{figure}
\noindent
La importancia de la hidrofobicidad e hidrofilicidad de las colas y cabezas respectivamente, es la orientación que toman los fosfolípidos al conformar la membrana. Esto es lo mismo que sucede con las proteínas insertas en la membrana, ocupando lugares en la pared celular que permiten minimizar la exposición al agua de los aminoácidos conformantes que tengan una pobre afinidad al agua y maximizando la de los que tengan una afinidad alta.
\begin{figure}[h]
	\centering
	\input{./Figures/Fig_5.eps_tex}
	\caption{Esquema de un fosfolípido, con detalle sobre la composición de la cabeza hidrófila \cite{Alberts}.}\label{Fig:Fig_5}
\end{figure}
\\\\
La pared celular no tiene un espesor definido, sino que varía en función de la sección que se está analizando y de las proteínas de membrana que haya insertas, y de forma más considerable según qué célula se está estudiando. Sin embargo, actualmente existe un valor aceptado y definido para \textit{células estándar} de 8 $[nm]$ \cite{Lombard}. Al trabajar con las proteínas embebidas y la mayoría de los eventos que ocurren y tienen relación con la membrana celular, el espesor es la única dimensión de importancia y para efectos prácticos la membrana puede considerarse un mar infinito de fosfolípidos y proteínas.\\\\
Como última propiedad de interés, se menciona que la membrana no es en ningún caso plana, ni tampoco rígida. Por el contrario, los fosfolípidos están en constante movimiento, provocando una ondulación en la bicapa, permitiendo entre otras cosas la formación de vacuolas y el desplazamiento de la célula. Entre los movimientos en que incurren los fosfolípidos están el desplazamiento ``horizontal" (siguiendo la referencia de la figura \ref{Fig:Fig_5-2}), que se efectúa en el plano de la membrana y es muy común, y el denominado ``\textit{flip - flop}", que corresponde a un cambio de ubicación entre dos fosfolípidos de forma transversal a la membrana; se puede decir que es un intercambio de lugar.\\\\
La membrana es la estructura fundamental de este estudio, pero es importante no dejar fuera el medio en el que está inmerso. Ya se nombraron los fluidos intra y extracelular, por lo que corresponde caracterizarlos un poco. El primer factor a considerar es que el ambiente en el que está la membrana es principalmente salino o, dicho más formalmente, una disolución con una cierta concentración de especies iónicas. En segundo lugar, dicha solución no es homogénea, sino que sigue una distribución que, junto a ciertas propiedades como la diferencia de potencial, propicia el intercambio iónico a través de la membrana. Con esto se concluye este capítulo, continuando con la metodología de trabajo utilizada.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\chapter{Metodología, funcionamiento e implementación}\label{Chap:Method}
Actualmente existen dos modelos ampliamente utilizados para representar un solvente. Uno se basa en una consideración de cada átomo que conforma el solvente de forma explícita, modelando el problema con dinámica molecular, y la otra en un modelo continuo, en el que se trabaja el solvente como un medio dieléctrico con propiedades representativas ponderadas.\\\\
El primer modelo tiene la gran ventaja de que permite una precisión enorme, pues es una consideración de todas las partículas de manera explícita, una por una, y los fenómenos que ocurren en todas (o muchas de) las interacciones. El gran nivel de detalle de este modelo resulta también ser su gran debilidad, pues la cantidad de cálculos que hay que hacer depende del número de partículas del sistema, significando un gran costo computacional.\\\\
El segundo modelo permite omitir la consideración de partículas individuales al seguir un enfoque continuo, pero al no ser una representación detallada del sistema, el modelo cae en impresiciones; un ejemplo de esto es no tomar en cuenta las fuerzas de van der Waals u otros fenómenos que ocurren a distancias muy pequeñas. A continuación se empieza a ensamblar la teoría presentada hasta ahora, explicando cómo el método BEM permite modelar una proteína inmersa en una solución a través de una discretización de la interfaz que los separa, cómo se genera dicha interfaz y qué es lo que se busca a partir de estos cálculos.

\section{Representación del modelo de solvente implícito mediante BEM}\label{Sec: Implicit_Solvent}
Ya se caracterizó el modelo de solvente implícito y cómo funciona. Un resultado de esto es, en el caso de que haya una distribución de iones libres en el solvente, la ecuación de Poisson - Boltzmann, que en resumidas cuentas toma la ecuación de Poisson y aplica una distribución de Boltzmann para incluir el efecto de los iones en una solución, por ejemplo salina.
\begin{equation}
-\nabla\cdot(\varepsilon(\mathbf{r})\cdot\nabla\phi(\mathbf{r})) = \rho(\mathbf{r}) + \sum_i ez_in_i^0\cdot \exp\left(-\frac{ez_i\phi}{k_BT}\right)
\end{equation}
donde $e$ es el valor de la carga del electrón, $z_i$ la carga de la $i$-ésima especie iónica, $n_i^0$ es el number density promediado de dicha especie de ion, $k_B$ es la constante de Boltzmann y $T$ la temperatura del sistema. Como esta ecuación varía de forma exponencial, se busca linealizarla para facilitar su aplicación en cálculos
\begin{equation}
-\nabla\cdot(\varepsilon(\mathbf{r})\cdot\nabla\phi(\mathbf{r})) = \rho(\mathbf{r}) + \sum_i ez_in_i^0\cdot \left(1 - \frac{ez_i\phi}{k_BT}\right)
\end{equation}
La suma es sobre todas las especies iónicas en la solución. Tras el supuesto de que esta última no tiene una carga neta, sino que es neutra ($\sum_i ez_in_i^0 = 0$) y si además no hay una dependencia espacial de $\varepsilon$, se llega a la ecuación de Poisson - Boltzmann utilizada comúnmente en los modelos implícitos
\begin{gather*}
\nabla^2\phi(\mathbf{r}) - \kappa^2\phi(\mathbf{r}) = - \frac{1}{\varepsilon}\rho(\mathbf{r})\label{eqn:PB_lineal}\numberthis \\
\kappa^2 = \frac{e}{\varepsilon k_BT}\sum_i en_i^0z_i^2
\end{gather*}
Siendo $\kappa$, llamado el inverso del largo de Debye, una medida del apantallamiento eléctrico a causa de las cargas móviles de los iones en solución.\\\\
Ahora, esto sirve más que nada de contexto para introducir la forma de trabajo del método BEM, así como los conceptos de Solvent Accesible Surface, Solvent Excluded Surface y energía de solvatación. Además es interesante comprender cómo atacar una distribución iónica en electrostática continua.\\\\
El método BEM requiere una superficie que permita diferenciar dos dominios. Es esta interfaz la que se discretiza y sobre la cual se integran las ecuaciones que modelan la propiedad a trabajar. En el caso de una proteína en un solvente existen por lo menos dos, pues la interfaz es una y hay un medio a cada lado. En primer lugar es importante saber cómo se establece esta superficie.
\subsection{Solvent Excluded y Solvent Accesible Surface}\label{subsec:SES_SAS}
De lo que se ha percibido a lo largo de este estudio, los dos métodos que se emplean usualmente para representar una superficie característica de una proteína son los que se indican en el título de esta parte. Ambos consisten en utilizar una \textit{sonda}, por lo general una molécula de agua, que interactúa con los radios de van der Waals de los átomos de la proteína. Si por ejemplo se quiere mapear la superficie exterior de la proteína o macromolécula, se hace ``\textit{rodar}" una molécula de agua por sobre la superficie de van der Waals de los átomos exteriores, de tal modo que la distancia entre los centros de un átomo de la macromolécula y el de la sonda de agua sea la suma de los radios de cada uno.\\\\
En el caso de la Solvent Accesible Surface (SAS), el centro de la molécula de agua es lo que define la superficie de trabajo. Esto genera puntas como se puede apreciar en la figura \ref{Fig:SAS_and_SES} . La distancia entre el centro del átomo a sondear y la SAS es entonces la suma del radio de van der Waals de dicho átomo y el radio de la molécula de sondeo.

\begin{figure}[h]
	\centering
	\input{Figures/Fig_7.eps_tex}
	\caption{Solvent Excluded y Solvent Accesible Surface, presentadas de forma esquemática.}\label{Fig:SAS_and_SES}
\end{figure}
\noindent
Por otra parte, la Solvent Excluded Surface (SES) considera el borde de la sonda como la definición de la superficie de la macromolécula. La superficie generada es por tanto suave, pues siempre consta al menos de una sección de arco de la sonda. La distancia entre el centro de un átomo de la macromolécula y la SES ya no está definida de forma tan clara como en el caso de la SAS, y a pesar de que en algunos casos coincide con ser simplemente el radio de van der Waals de un átomo de la proteína, esto no es una regla.\\\\
A pesar de las diferencias, no existe una razón para preferir una sobre la otra, y depende simplemente de lo que se busque lograr en cada situación. En el caso de este trabajo, y principalmente por heredar la metodología que se venía aplicando de antes, se utiliza la Solvent Excluded Surface para definir la superficie de las moléculas de estudio, puesto que, como se dijo, la superficie resultante es suave.

\subsection{La ecuación de Poisson - Boltzmann (PB) y la Boundary Integral Equation (BIE)}\label{subsec:BIE_PB}
Teniendo ya la ecuación PB, se presenta rápidamente el caso del sistema para una proteína en un solvente con iones; el objetivo de esto es mostrar cómo se usa el método BEM, aplicado específicamente a una discretización de superficie proteínica. Para esto hay que considerar que hay dos medios en el sistema, y una interfaz: el sistema exterior, que como es usual consiste en agua salina $\Omega_1$, el ensamblaje de $N_q$ átomos con $q_j$ cargas netas que conforman la proteína y que será el sistema interior $\Omega_2$, y la Solvent Excluded Surface que se asume separa ambos dominios recién nombrados, encerrando al segundo de estos.\\\\
Las ecuaciones corresponden entonces a Poisson por dentro, pues existe una distribución de cargas puntuales en un medio dieléctrico, y Poisson - Boltzmann por fuera, lo que considera la teoría explicada anteriormente (ecuación \ref{eqn:PB_lineal} con $\rho = 0$).
\begin{align*}
\text{En el soluto:}&\qquad\nabla^2\phi_1(\mathbf{r}) = -\frac{\rho(\mathbf{r})}{\varepsilon}\\
\text{En el solvente:}&\qquad\nabla^2\phi_2(\mathbf{r}) = \kappa^2(\mathbf{r})\phi_2(\mathbf{r})\\
\text{Con condiciones de borde:}&\qquad \frac{\partial\phi_1}{\partial\hat{\mathbf{n}}} = \frac{\varepsilon_2}{\varepsilon_1}\frac{\partial\phi_2}{\partial\hat{\mathbf{n}}}\quad ; \quad \phi_1 = \phi_2
\end{align*}
De lo presentado sobre el método BEM en la sección \ref{Sec:BEM_theory}, se sabe que el sistema cumple con la ecuación (\ref{eqn:BEM_equation}).
%\begin{equation*}
%\frac{\phi(\mathbf{r}_{\partial\Omega})}{2} = \int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r}_{\partial\Omega})\cdot G(\mathbf{r}_{\partial\Omega},\mathbf{r}_{\partial\Omega}^*) - \frac{\partial}{\partial\hat{\mathbf{n}}}G(\mathbf{r}_{\partial\Omega},\mathbf{r}_{\partial\Omega}^*)\cdot\phi(\mathbf{r}_\Omega)\text{ }d\partial\Omega^*
%\end{equation*}
Esta es válida para ambas direcciones hacia la interfaz. Es decir, si es que la aproximación a la superficie de la proteína ocurre por fuera, la ecuación es igualmente válida que si ocurre por dentro. Ambos dominios, y por ende ambas ecuaciones gobernantes, se encuentran en la SES, por lo que es ahí donde se aplican las condiciones de contorno de electrostática presentadas en la sección \ref{Sec:Image_Method}, específicamente (\ref{eqn:jump_condition}) y (\ref{eqn:pot_continuity}).
%\begin{equation*}
%\phi_1 = \phi_2 \qquad\qquad \varepsilon_1\frac{\partial\phi_1}{\partial n} = \varepsilon_2\frac{\partial\phi_2}{\partial n}
%\end{equation*}
Llevando ambas ecuaciones a una formulación integral sobre la frontera, el sistema $2\times2$ para una proteína en solución con iones queda \cite{Cooper2015}
\begin{flalign*}
\frac{\phi_{1}(\mathbf{r}^*)}{2} \,\,- &\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}G_Y(\mathbf{r},\mathbf{r}^*)\cdot\phi(\mathbf{r})\, d\partial\Omega\,\, +\\
&\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r})\cdot G_Y(\mathbf{r},\mathbf{r}^*)\, d\partial\Omega = 0\label{eqn:BEM_Yukawa} \numberthis \\\\
\frac{\phi_{2}(\mathbf{r}^*)}{2}\, + &\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}G_L(\mathbf{r},\mathbf{r}^*)\cdot\phi(\mathbf{r})\, d\partial\Omega\,\, -
\\ &\int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r})\cdot G_L(\mathbf{r},\mathbf{r}^*)\, d\partial\Omega = \frac{1}{4\pi\varepsilon}\sum_{j=0}^{N_q}\frac{q_j}{\mathbf{r} - \mathbf{r}_j}\label{eqn:BEM_Laplace}\numberthis
\end{flalign*}
Se puede reconocer, con algo de imaginación, que (\ref{eqn:BEM_Laplace}) es la ecuación de Poisson de electrostática (\ref{eqn:Laplace_potential}), con una distribución de cargas puntuales, siendo todo el lado izquierdo de la igualdad el potencial sobre la superficie. Este último hecho también es válido para (\ref{eqn:BEM_Yukawa}); el lado izquierdo es el potencial sobre la superficie. Las variables de $\mathbf{r}$ y $\mathbf{r}^*$ corresponden a una evaluación sobre la superficie $\partial\Omega$, mientras que $\mathbf{r}_j$ son las posiciones de las mencionadas cargas puntuales. Los subíndices $L$ e $Y$ son propios de \textit{Laplace} y \textit{Yukawa}. La función de Green para la ecuación de Laplace ya se presentó en la sección \ref{Sec:BEM_theory}, mientras que la función de Green desarrollada por Yukawa, que corresponde a la ecuación de Poisson - Boltzmann, es
\begin{equation}
G_Y(\mathbf{r},\mathbf{r}^*) = \frac{\text{exp}(-\kappa\cdot|\mathbf{r} - \mathbf{r}^*|)}{4\pi|\mathbf{r} - \mathbf{r}^*|}
\end{equation}
Para simplificar la notación, se presentan los operadores Single y Double-Layer Potential.
\begin{flalign}
\text{\normalsize{Single-Layer Potential:}}& \,\,\, V(\phi(\mathbf{r})) = \int_{\partial\Omega}\phi(\mathbf{r}^*)\cdot G(\mathbf{r},\mathbf{r}^*)\, d\partial\Omega^* & \label{eqn:SLP}\\
\text{\normalsize{Double-Layer Potential:}}& \,\,\, K(\phi(\mathbf{r})) = \int_{\partial\Omega}\phi(\mathbf{r}^*)\cdot \frac{\partial}{\partial\hat{\mathbf{n}}}G(\mathbf{r},\mathbf{r}^*)\, d\partial\Omega^* & \label{eqn:DLP}
\end{flalign}
En este trabajo no se utilizan los operadores de Yukawa, pero si los de Laplace, por lo que es conveniente presentarlos de forma explícita.
\begin{align}
	V_L(\phi(\mathbf{r})) = \int_{\partial\Omega}&\phi(\mathbf{r}^*)\cdot \frac{1}{4\pi|\mathbf{r}-\mathbf{r}^*|}\, d \partial\Omega^* \label{eqn:SLO_Laplace}\\
	K_L(\phi(\mathbf{r})) = \int_{\partial\Omega}&\phi(\mathbf{r}^*)\cdot \frac{1}{4\pi}\frac{\partial}{\partial\hat{\mathbf{n}}}\frac{1}{|\mathbf{r}-\mathbf{r}^*|}\, d\partial\Omega^*\label{eqn:DLO_Laplace}
\end{align}
Al aplicar las condiciones de contorno, el sistema de ecuaciones deriva en
\begin{gather}
		\frac{\phi_2(\mathbf{r})}{2} + K_L(\phi_2(\mathbf{r})) - V_L\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi_2(\mathbf{r})\right) = \frac{1}{4\pi\varepsilon_2}\sum_{j=0}^{N_q}\frac{q_j}{|\mathbf{r} - \mathbf{r}_j|}\\
		\frac{\phi_2(\mathbf{r})}{2} - K_Y(\phi_2(\mathbf{r})) + \frac{\varepsilon_2}{\varepsilon_1}V_Y\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi_2(\mathbf{r})\right) = 0
\end{gather}
Ahora bien, si se subdivide la superficie de la proteína en $N$ paneles, en este caso triangulares, las ecuaciones siguen siendo válidas para cada panel; estas se trabajan \textit{colocándolas} en los centroides de cada panel (llamado a partir de ahora \textit{punto de colocación}), permitiendo así su discretización de forma representativa.\\\\

\begin{figure}[h]
	\centering
	\input{Figures/BEM_scheme.eps_tex}
	\caption{Forma 2D de dividir la frontera del dominio de integración para aplicar el método BEM a cada elemento de borde.}
\end{figure}

\noindent
Las propiedades que se buscan - potencial y su derivada respecto a la normal - son incógnitas. Se asume entonces que dichas propiedades son constantes sobre un mismo panel, por lo que salen de la integral respectiva en ambas ecuaciones y se genera un sistema de la forma $\underline{A}\mathbf{x} = \mathbf{b}$.

\begin{equation}\label{eqn:PB_equation_system}
	\renewcommand\arraystretch{1.6}
	\begin{pmatrix}
		\frac{1}{2} + K_L & -V_L \\ \frac{1}{2} - K_Y & V_Y
	\end{pmatrix}
	\begin{pmatrix}
		\phi \\ \frac{\partial}{\partial\hat{\mathbf{n}}}\phi
	\end{pmatrix}
	=
	\begin{pmatrix}
		\frac{1}{4\pi\varepsilon}\sum_{j=0}^{N_q}\frac{q_j}{|\mathbf{r} - \mathbf{r}_j|} \\ 0
	\end{pmatrix}
\end{equation}

\noindent
Resolviendo (\ref{eqn:PB_equation_system}) para los $N$ paneles se calcula la energía potencial del sistema, y multiplicando por una serie de factores de transformación de unidades, se obtiene la energía sobre la superficie de la proteína. Con estos valores se puede entrar a calcular la reacción del medio sobre dicha superficie, lo que corresponde a la energía de solvatación. Se adjunta una definición de \textit{energía de solvatación} en el Apéndice \ref{Anexo:Solv_Energy} de este escrito. Se profundiza más sobre el cálculo energético en el siguiente apartado, particularmente en la descripción del programa \texttt{PyGBe}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{Descripción del software utilizado}\label{Sec:SW_Description}
En el transcurso de este trabajo se hizo uso de una serie de programas para ayudar a implementar el modelo encontrado, probarlo, o comparar los resultados obtenidos. Se mencionan y describen en esta sección, en mayor o menor profundidad, los cuatro softwares sin los cuales esta memoria no podría haberse realizado.

\subsection{MSMS}\label{subsec:MSMS}
Este resulta el programa menos utilizado directamente en el trabajo, pero que sin embargo es fundamental y de hecho es empleado de una u otra forma por los otros en esta sección. MSMS permite mallar la superficie de un átomo o conjunto de átomos en paneles triangulares, entregando la Solvent Excluded Surface (SES) en función de un ``radio de sondeo", habilitando además al usuario para definir una variedad de parámetros que facilitan obtener modelos para realizar diferentes pruebas. El programa está escrito en lenguaje \texttt{C} y arroja un par de archivos, uno con una numeración para identificar los triángulos, y el otro con las coordenadas de los vértices de dichos triángulos. Más allá de esto, no es necesario ahondar en el funcionamiento del programa, pues su funcionalidad es lo que aquí importa.

\subsection{APBS}\label{subsec:APBS}
Adaptive Poisson-Boltzmann Solver, más conocido por su sigla \texttt{APBS}, es un código escrito en \texttt{C} que permite calcular distintos tipos de energías en un sistema molécula o macromolécula - solvente. De particular interés resulta en este caso la energía de solvatación de una molécula o macromolécula. El programa emplea el método de diferencias finitas por defecto, o si se desea también está disponible FEM, para parcelar un dominio de integración en $l\times m\times n$ elementos en los ejes $x$, $y$ y $z$, resolviendo el sistema de ecuaciones con teoría electrostática clásica, es decir considerando una descripción macroscópica del problema. Ahora bien, la gracia de este software es la capacidad de resolver la ecuación de Poisson-Boltzmann para una concentración, carga y radio de iones solicitados en el solvente. El programa realiza el cálculo energético de la molécula o macromolécula en dos situaciones: en el solvente, ya en su situación final (con o sin distribución de Boltzmann, según se requiera), y en un punto de referencia que corresponde a los átomos que conforman a la (macro)molécula en un dieléctrico correspondiente a la permitividad de dicha (macro)molécula; en definitiva, esto es calcular las energías debido a interacciones de Coulomb. Luego, las energías se restan, lo que corresponde a la energía de solvatación, siguiendo su definición, del cuerpo bajo estudio.\\\\
APBS tiene gran fama de ser confiable y con una rapidez de cómputo relativamente alta, esto último en especial en comparación con programas explícitos (MD) como CHARMM o LAMMPS, pero debido al método de modelación que utiliza, puede ser problemático representar secciones de una molécula que tengan interacciones que requieran una alta refinación de la malla, como por ejemplo en el caso en que un ion pase por un canal iónico, pues las energías dependen de la distancia ion - proteína y la geometría de la proteína. Esto no quita que el programa sea altamente confiable, y es por eso y por la formulación en electrostática en continuos que emplea que se utiliza como referencia para comparar resultados.\\\\
Es importante explicar que, como se utiliza el método de diferencias finitas, se debe establecer un dominio de integración que luego se subdivide en puntos o nodos. Este dominio es finito y en las superficies límites se establecen condiciones de contorno. Es importante para este estudio ahondar un poco en cómo funcionan los tres tipos de condiciones que se pueden utilizar. En primer lugar, se puede imponer la condición que tiene el potencial al infinito, que es igual a cero - esta condición es llamada \texttt{zero}. Otra alternativa es ubicar una esfera con una carga puntual, un dipolo y un cuadrupolo, cuyo radio es el de la molécula modelada; la idea es que los momentos (de la carga puntual, dipolo y cuadrupolo) sean representativos de los de la macromolécula, y es con esta información que se evalúa el potencial en el contorno - se denomina condición \texttt{sdh}. La última opción que interesa en el contexto de este trabajo consiste en tomar los átomos componentes de la molécula y formar esferas que no interactúan entre ellas, con las cargas y radios correspondientes, y evaluar el potencial en la frontera del dominio - recibe el nombre \texttt{mdh}. Todo esto se puede encontrar en el sitio dedicado al programa \cite{pdb2pqr_1}

\subsection{APBSmem}\label{subsec:APBSmem}
APBSmem es un programa de cálculos energéticos en sistemas proteína - membrana con teoría electrostática en continuos. Funciona de la misma forma que APBS (APBSmem es de hecho una GUI que solo llama a APBS con dos grupos de archivos distintos, uno pre y uno pos consideración de la membrana) y facilita el trabajo a usuarios con poco conocimiento computacional a través de una interfaz gráfica.\\\\
Este software escrito en \texttt{Java} funciona siguiendo una serie de pasos, en función de parámetros indicados por el usuario:
\begin{itemize}
	\item[1.] Generar mapas de permitividades $\varepsilon$, radios de Debye o accesibilidad iónica $\kappa$, y densidad de carga $\rho$ para una proteína en disolución.
	\item[2.] Utilizar esos mapas con el programa APBS base para calcular la energía de solvatación de una proteína en disolución.
	\item[3.] Generar un nuevo set de mapas de las propiedades en 1., pero esta vez incluyendo la membrana según parámetros indicados por el usuario (espesor y permitividad principalmente).
	\item[4.] Correr nuevamente APBS para obtener la energía de solvatación de la proteína inserta en la membrana.
	\item[5.] Restar las energías de 4. y 2., entregando esta resta para indicar la afinidad de la proteína con la membrana y el resto del entorno.
\end{itemize}
APBSmem entrega la energía total de la proteína embebida en la membrana menos la del soluto en solvente, que en caso de ser un estado de mínima energía constituye el estado más probable del sistema. En resumen, si el resultado entregado por APBSmem es $<0$, la proteína tiene más probabilidades de estar inserta en la membrana que en la solución salina original, y visceversa.\\\\
Para poder comparar los resultados presentados más adelante con los de APBSmem y APBS, es necesario sumar las energías de solvatación entregadas por estos últimos dos programas a modo de obtener la energía de solvatación del sistema membrana - proteína. Otro camino es modificar el archivo de entrada \texttt{.solv.in} para que calcule directamente lo mismo que \texttt{PyGBe}.

\subsection{PyGBe}\label{subsec:PyGBe}
Python, GPUs and Boundary elements for biomolecular electrostatics (PyGBe) es una biblioteca de \texttt{Python} que permite, entre otras cosas, calcular energías de solvatación en macromoléculas. El programa utiliza un algoritmo de tipo treecode a modo de implementación del Fast Multipole Method (FMM) para desarrollar cálculos, y además si estos son muy demandantes, pueden llevarse a cabo en GPU en vez de en CPU. Este trabajo se realizó en una versión básica de PyGBe que no incluye el uso de GPUs ni del FMM. Sin embargo, el resultado es el mismo, pues las características de las que carece son métodos de aceleración y no modifican la solución. La versión de \texttt{PyGBe} utilizada forma y resuelve un sistema de ecuaciones mediante la generación de una matriz $\underline{A}$, y es esto lo que se modifica para incluir el aporte de membrana de forma implícita, como se explica más adelante.\\\\
PyGBe funciona leyendo una serie de archivos. Los inputs del programa son un \texttt{.config} y un \texttt{.param}. Además, el primero de estos dos archivos hace referencia a otro par de archivos, \texttt{.face} y \texttt{.vert}, así como a un \texttt{.pqr} o \texttt{.crd}. En primera instancia se profundiza en qué son estos archivos, y luego se presenta y desarrolla la estructura funcional de \texttt{PyGBe} (\texttt{pygbe\_matrix} específicamente).

\subsubsection{Archivo \texttt{.config}}
El archivo \texttt{.config} que sirve como entrada directa al programa consta de una serie de parámetros que atañen principalmente a las características físicas del modelo. Se trabaja en una estructura de campos, siendo cada uno representativo de uno de los dominios de integración. Siempre habrá un \texttt{FIELD} que representa el solvente exterior a la proteína, designado con el número 0, y los campos consecutivos listan las propiedades de los otros medios a considerar. Esto permite modelar casos en los que la proteína se plegó sobre sí misma dejando solvente encerrado en pequeños huecos o cavidades. Además este set de parámetros sirve de puntero para los archivos que entregan información sobre las cargas (\texttt{.pqr} o \texttt{.crd}) y sobre la geometría del problema (\texttt{.face} y \texttt{.vert}).\\\\
El archivo \texttt{.config} tiene en cada una de sus líneas, que son los campos (\texttt{FIELD}), información sobre si el dominio debe ser tratado mediante la ecuación de Poisson o la de Poisson - Boltzmann, si se requiere el cómputo de energías en el medio, cuál es la permitividad $\varepsilon$ de dicho medio y cuál es el inverso de la longitud de Debye. También se incluye información sobre si hay cargas en el medio y en qué archivo está la data al respecto, qué campo(s) hay al interior de cierto(s) \texttt{FIELD}(s) y cuál(es) al exterior\footnote{Por ejemplo, un único ion (que forma una esfera como superficie de v. d. Waals) tendría agua por fuera y nada por dentro.}, y cuáles son sus designaciones.\\\\
Los archivos \texttt{.face} y \texttt{.vert} son información sobre la superficie de la proteína. El primero de ambos documentos numera y ordena los paneles en los que se subdivide la interfaz molécula - solvente, mientras que el segundo entrega las posiciones espaciales de los vértices de dichos paneles triangulares. Los archivos \texttt{.pqr} y \texttt{.crd} son información sobre la ubicación, radios de van der Waals y carga neta de los átomos constituyentes de la molécula que se busca modelar.

\subsubsection{Archivo \texttt{.param}}
El archivo \texttt{.param} por otro lado tiene información propia del método de modelación matemática del problema, aunque solamente se describen a continuación los que se utilizan en \texttt{pygbe\_ matrix}. Aquí van la precisión computacional (double o float), el número de puntos de cuadratura Gaussiana para tres tipos de resolución que se explicarán más a fondo en lo sucesivo, un parámetro que indica cuándo utilizar el método de resolución semianalítica (también se explica más adelante), el error relativo de máquina, y parámetros para el método de mínimos residuos general, como número máximo de iteraciones, iteraciones para el \textit{reinicio} del método, y la tolerancia entre iteraciones tras la cual se acepta el resultado calculado.\\\\
Ahora se procede a explicar el funcionamiento del programa, pues este trabajo consiste en la modificación del mismo para integrar la capacidad de cálculo de interfaces por sobre y bajo la macromolécula.

\subsubsection{Forma de operación del programa}
\texttt{PyGBe} funciona siguiendo una serie de pasos para el cálculo de energías. En primer lugar, el programa lee los archivos \texttt{.config} y \texttt{.param} y guarda los parámetros correspondientes. Con esta información y la geometría importada (existe una función que se encarga de eliminar los paneles con áreas muy pequeñas, tendiendo a 0), la meta es crear un sistema como \ref{eqn:PB_equation_system} que se cumpla para todos los paneles de la discretización. Se generan entonces dos sets de arreglos que correspoden a la clases definida como \textit{superficie}, uno que guarda las fuentes (\texttt{src}) y otro que guarda los objetivos (\texttt{tar}). El programa calcula las interacciones electrostáticas entre todos los objetivos y todas las fuentes: para un panel arbitrario, todos los paneles del ensamblaje tienen influencia, incluyéndose a si mismo. Para generar la matriz del sistema, se requieren los single y double layer operators de cada panel para la ecuación por fuera y por dentro, y como son operadores integrales, se utiliza cuadratura Gaussiana para discretizarlos. Las denominadas fuentes son los puntos de cuadratura de Gauss, que representan el efecto del panel. Esto es, si los paneles objetivo están más allá de cierto rango con respecto a las fuentes. La información sobre qué operador se debe utilizar (Laplace o Yukawa) para cada \texttt{FIELD} viene del archivo \texttt{.config}, así como los parámetros físicos requeridos en cada ecuación ($\kappa$ y $\varepsilon$, por ejemplo).\\\\
Para lograr esta discretización y dado un panel arbitrario, los paneles lejanos se trabajan con pocos puntos de cuadratura, en vista de que su distancia hasta el panel de referencia es grande respecto del parámetro \textit{threshold}. Para los paneles que están a una distancia inferior a este valor, pero aún no están suficientemente cerca, se utiliza simplemente una mayor densidad de puntos de cuadratura Gaussiana sobre la superficie y se procede a discretizar las integrales de la misma forma. Por último, para los casos en que los paneles objetivo están muy cerca de las fuentes, o el panel fuente y el objetivo son el mismo, la cuadratura Gaussiana se remplaza por un método semianalítico que reduce la integral de área a una integral de línea, siendo esta última la que se discretiza, y solo sobre los bordes del triángulo; este método surge de la publicación de Hess y Smith \cite{Hess} para el caso de Laplace, y Zhu \textit{et al.} \cite{Zhu} para el caso de Yukawa, y se explica a fondo en la sección \ref{subsec:BEM_PyGBE}.\\\\
Con los valores de los operadores ya calculados, se procede a generar la matriz $\underline{A}$ del sistema, ubicando cada elemento $V_L$, $K_L$, $V_Y$ y/o $K_Y$ donde corresponda\footnote{Se escribe y/o porque es el sistema físico/real el que se compone de una proteína rodeada de una solución, pero se podría realizar cualquier combinación de casos, como por ejemplo agua por dentro y por fuera.}. El ordenamiento de la matriz incide en el lado derecho de la ecuación, por lo que también hay que organizar la ubicación de los elementos del vector solución para que corresponda al sistema físico que se busca modelar. Luego de generar un precondicionador para el sistema de ecuaciones, el código utiliza el método Generalized Minimal Residues (GMRES) para calcular el vector de incógnitas que tiene los valores de $\phi$ y $\partial/\partial\hat{\mathbf{n}}(\phi)$ para todos los paneles. Este vector se le entrega a una función que toma los valores y calcula la energía de solvatación del sistema, aplicando una discretización con cuadratura Gaussiana al campo de reacción causado por la molécula sobre la superficie de esta última. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Implementación del método de imágenes en el programa PyGBe}\label{Sec:Implementation}
El objetivo principal del trabajo aquí presentado es definir una forma de calcular la energía de solvatación de un átomo o molécula inserta entre dos interfaces, lo que tiene un simil biológico conocido en una proteína embebida en una membrana. Hay que recalcar que esta manera de representar las interfaces correspondientes a la membrana tiene dos restricciones importantes. En primer lugar, solo se puede aplicar a las cargas que se encuentran dentro de la membrana; para poder considerar proteínas transmembrana o similares hay que buscar otra forma de modelar. En segundo lugar, el modelo presentado y aplicado no permite incluir el efecto de iones en la disolución. Dicho de otra forma, se utiliza el método BEM para trabajar una ecuación de Poisson en vez de una ecuación de Poisson-Boltzmann. Además de dichas restricciones, surge otra que en vista del enfoque continuo que se da a la formulación, no incide mucho, pero aún así es importante mencionar: la bicapa fosfolipídica, tal como se muestra en el apartado 2.6, no es exactamente continua, sino que hay separación entre los fosfolípidos y, más importante, entre las cabezas polares de éstos. Sin perjuicio de lo anterior, la implementación exitosa del método de imágenes supone un avance, pues permite comprobar la viabilidad de esta parte de la teoría de campos electromagnéticos como representación de una membrana.\\\\
Como se adelanta en la sección de descripción de los programas utilizados, \texttt{PyGBE} es modificado, añadiendo una opción que permite calcular la energía de solvatación de una molécula en un sistema conformado por un medio $1$ encerrado por un medio $2$ (figura \ref{Fig:Infty_Images}). Antes de elaborar sobre la inclusión de esta opción al software, es imperativo ahondar en la teoría electrostática para este tipo de situaciones.

\subsection{Modelo de un sistema de tres medios dieléctricos con dos interfaces} \label{subsec:2_Inter_Images}
La presente sección se basa fundamentalmente en el desarrollo visto en la publicación de Yang, Liaw y Lim \cite{Pei-kun}. La teoría electrostática puede ser encontrada en el libro de Emile Durand \cite{Durand}, pero por lo que se sabe, el grupo de Yang es el único que ha utilizado esta teoría para representar una membrana con el método de imágenes.\\\\
En este paper se presenta una herramienta basada en el método de cargas imagen aplicado a sistemas rectangulares con más de una interfaz, denominado método RIC - Rectangular Image Charge. Un sistema de una interfaz planar infinita tiene una solución analítica para el caso de una carga puntual (sección \ref{subsec:Reaction_Field}), pero si se considera el caso de un sistema con dos interfaces planares paralelas y una carga puntual en el medio dieléctrico encerrado, el problema se complica.\\\\
Si se tienen tres medios dieléctricos 1, 2 y 3, tales que las constantes dieléctricas de los medios 1 y 3 son iguales entre sí $\varepsilon_1 = \varepsilon_3$ (figura \ref{Fig:Infty_Images}), entonces una carga en el medio 2 genera un campo de reacción en los medios 1 y 3, y cada uno de estos induce una reacción en los otros medios. Se genera así un efecto dominó, lo que se traduce en una sumatoria infinita \cite{Pei-kun} como se presenta a continuación
\begin{equation}\label{eqn:RIC_single}
\phi(\mathbf{r}) = \sum_{i=-\infty}^\infty\frac{q_i}{4\pi\varepsilon_2|\mathbf{r} - \mathbf{r}_i|}
\end{equation}
\noindent
donde
\begin{equation}\label{eqn:RIC_terms}
q_i = q\left(\frac{\varepsilon_2 - \varepsilon_1}{\varepsilon_1 + \varepsilon_2}\right)^{|i|} \qquad x_i=(-1)^ix_0 + i\cdot a \qquad \mathbf{r}_i=(x_i,y,z)
\end{equation}
\noindent
Cada término de la sumatoria es menor al anterior en magnitud, tendiendo a converger de forma relativamente rápida.
\begin{figure}[h]
\centering
\input{./Figures/Fig_4.eps_tex}
\caption{La imagen superior es la situación real para el caso de una carga, mientras que la figura inferior es el sistema trabajado con el método de imágenes. Esto sigue de manera infinita, pero solo se muestran unas pocas cargas por motivos obvios.}
\label{Fig:Infty_Images}
\end{figure}
\noindent
Una analogía de este fenómeno y que también tiene que ver con electromagnetismo es lo que ocurre al mirar hacia uno de dos espejos paralelos enfrentados. La imagen de uno se refleja infinitamente en el otro, disminuyendo en tamaño con cada reflejo.\\\\
Considerar un número mayor de cargas ($N_q$) simplemente implica sumar sobre estas, considerando el potencial debido a la interacción electrostática entre las partículas componentes del sistema, pues la sumatoria entre $-\infty$ e $\infty$ da cuenta del campo de reacción, haciendo que la ecuación (\ref{eqn:RIC_single}) quede
\begin{gather*}
\phi(\mathbf{r}) = \sum_{\substack{j = 1\\j\neq i}}^{N_q} \frac{q_j}{4\pi\varepsilon_2|\mathbf{r} - \mathbf{r}_j|} + \sum_{j=1}^{N_q}\sum_{\substack{i=-\infty\\i\neq 0}}^\infty\frac{q_{j,i}}{4\pi\varepsilon_2|\mathbf{r} - \mathbf{r}_{j,i}|} \numberthis \label{eqn:RIC_multi} \\
\mathbf{r} \neq \mathbf{r}_j\quad ; \quad \mathbf{r} \neq \mathbf{r}_{j,i}
\end{gather*}
En este caso, $\mathbf{r}_{j,i}$ corresponde a la posición de la $i$-ésima imagen de la $j$-ésima carga del arreglo de cargas. Así también se define $q_{j,i}$ como la $i$-ésima imagen de la $j$-ésima carga del arreglo. El primer término es el potencial de Coulomb en algún punto debido a las cargas. El segundo término corresponde al efecto del campo de reacción a causa del conjunto de cargas.\\\\
Lo que interesa es el segundo término, pues el primero ya ha sido implementado en el programa previamente. Con esto se puede modelar la reacción de los medios por fuera de las interfaces de la membrana o, mejor dicho, el comportamiento de estos debido a la presencia de las cargas de la proteína. Esto es importante, pues nunca se modela directamente una membrana, sino que queda todo implícito sobre la superficie de la proteína. Es más, el solvente correspondiente al agua se omite, quedando solo representado mediante la ecuación (\ref{eqn:RIC_single}); la molécula esta ahora en un medio con las propiedades de la membrana, y es a través de la expresión para el campo de reacción que se incluye el efecto de las interfaces que por fuera tienen agua.\\\\
El método BEM exige, a través de sus operadores integrales Single y Double Layer Potential, que haya una función de Green que modele el comportamiento del potencial de una carga (por ende la carga $q$ debe ser unitaria), así como la derivada de dicha función. Por lo tanto, a continuación se presentan estos dos operadores que se utilizan en la modelación de la membrana. Los operadores se denominan a continuación con el subíndice $M$, por ser propios de un sistema con membrana.
\begin{align}
V_M(\phi(\mathbf{r})) = \int_{\partial\Omega}\phi(\mathbf{r})\frac{1}{4\pi}\sum_{i=-\infty}^{\infty}\frac{q_i}{|\mathbf{r} - \mathbf{r}^*|}d\partial\Omega \label{eqn:SLOp_Memb}\\
K_M(\phi(\mathbf{r})) = \int_{\partial\Omega}\phi(\mathbf{r})\frac{1}{4\pi}\sum_{i=-\infty}^{\infty}q_i\frac{\partial}{\partial\hat{\mathbf{n}}}\left(\frac{1}{|\mathbf{r} - \mathbf{r}_i^*|}\right)d\partial\Omega \label{eqn:DLOp_Memb}
\end{align}
Los términos $q_i$ y $\mathbf{r}_i^*$ retienen las definiciones de \ref{eqn:RIC_terms}, y tanto $V_M$ como $K_M$ siguen siendo válidos para cada panel, tal como sucedía con los operadores de la sección \ref{subsec:BIE_PB}. Se puede apreciar que la complejidad no está en la formulación, puesto que los operadores del método de imágenes son simplemente una suma lineal de operadores Single y Double Layer Potential de Laplace. El obstáculo reside en la sumatoria infinita, que demanda muchos recursos computacionales, pues como se explica en los siguientes párrafos, cada punto de cuadratura tiene $n$ imágenes por arriba y por abajo, así como la imagen $i=0$, lo que da un total de $2n + 1$ imágenes.

\subsection{El método BEM y PyGBe con el efecto de la membrana} \label{subsec:BEM_PyGBE}

El método de imágenes presentado permite dar cuenta del efecto de dos interfaces de forma implícita, y esa es su gran fortaleza, pues no se requiere una discretización de las interfaces membrana - solvente. En vez de eso, se reproduce el efecto de los campos de reacción debido a los paneles de la proteína al modificar las funciones de Green de los operadores Single y Double Layer Potential. Ahora se ve más detalladamente cómo se trabaja este tipo de sistema de forma numérica.\\\\
Se debe considerar que el método de imágenes como se aplica en este caso considera que la molécula a modelar siempre está encerrada por dos interfaces paralelas ubicadas en planos $z = \pm z_0$. Con esto claro, se procede a explicar cómo se trabaja matemáticamente con BEM.\\\\
Se tienen las ecuaciones por fuera y por dentro de la interfaz de la molécula y dentro de la membrana; la de afuera lleva implícitamente el aporte del campo de reacción del solvente. El sistema de ecuaciones para una molécula embebida en una membrana de espesor $a$, permitividades de membrana $\varepsilon_m$, de proteína $\varepsilon_p$ y de solvente (agua) $\varepsilon_w$ es
\begin{flalign*}
\frac{\phi_1(\mathbf{r})}{2} + \int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}&\left(\phi_1(\mathbf{r})\right)\cdot\sum_{i=-n}^{n}\frac{q_i}{4\pi|\mathbf{r} - \mathbf{r}_i^*|}\, d\partial\Omega & \\
 - \int_{\partial\Omega}\phi_1(\mathbf{r})&\cdot\sum_{i = -n}^{n}\frac{q_i}{4\pi}\nabla\left(\frac{1}{|\mathbf{r} - \mathbf{r}_i^*|}\right)\cdot\hat{\mathbf{n}}\, d\partial\Omega = 0\numberthis \label{eqn:membrane1} & \\\\
\frac{\phi_2(\mathbf{r})}{2} - \int_{\partial\Omega}\frac{\partial}{\partial\hat{\mathbf{n}}}&\left(\phi_2(\mathbf{r})\right)\cdot\frac{1}{4\pi|\mathbf{r} - \mathbf{r}^*|}\, d\partial\Omega & \\
+ \int_{\partial\Omega}\phi_2(\mathbf{r})\cdot\nabla&\left(\frac{1}{4\pi|\mathbf{r} - \mathbf{r}^*|}\right)\cdot\hat{\mathbf{n}}\, d\partial\Omega = \frac{1}{4\pi\varepsilon_p}\sum_{j = 1}^{N_q}\frac{q_j}{|\mathbf{r} - \mathbf{r}_j|} & \numberthis \label{eqn:membrane2}
\end{flalign*}
reteniendo su definición los términos \ref{eqn:RIC_terms} y definiendo el radio $\mathbf{r}^*_i$
\begin{equation*}
q_i = q\left(\frac{\varepsilon_p - \varepsilon_m}{\varepsilon_p + \varepsilon_m}\right)^{|i|} \qquad\qquad z_i=(-1)^iz_0 + i\cdot a \qquad\qquad \mathbf{r}^*_i = (x, y, z_i)
\end{equation*}
Aplicando las condiciones de contorno de electrostática - continuidad del potencial y el salto en la componente normal del campo eléctrico (ecuaciones (\ref{eqn:jump_condition}, \ref{eqn:pot_continuity})) - el sistema de ecuaciones se puede llevar a uno con incógnitas en términos de un único $\phi$ y su derivada $\partial/\partial\hat{\mathbf{n}}(\phi)$. Utilizando la notación de los operadores Single y Double Layer Potential para el método de imágenes (\ref{eqn:SLOp_Memb}, \ref{eqn:DLOp_Memb}) y los de Laplace (\ref{eqn:SLO_Laplace}, \ref{eqn:DLO_Laplace}), se obtiene la BIE para la situación estudiada
\begin{gather}
\frac{\phi_2(\mathbf{r})}{2} + K_L(\phi_2(\mathbf{r})) - V_L\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi_2(\mathbf{r})\right) = \frac{1}{4\pi\varepsilon_p}\sum_{j = 1}^{N_q}\frac{q_j}{|\mathbf{r} - \mathbf{r}_j|}\label{eqn:BIE_membrane1}\\
\frac{\phi_2(\mathbf{r})}{2} - K_M(\phi_2(\mathbf{r})) + \frac{\varepsilon_2}{\varepsilon_1}V_M\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi_2(\mathbf{r})\right) = 0\label{eqn:BIE_membrane2}
\end{gather}
Estas ecuaciones están siendo aplicadas sobre la superficie de la molécula, en este trabajo de carácter Solvent Excluded. Para resolver de forma numérica, la SES se subdivide en $N$ paneles triangulares y las ecuaciones \ref{eqn:BIE_membrane1} y \ref{eqn:BIE_membrane2} son colocadas en el centroide de cada panel. Las variables dependientes desconocidas están dentro de la integral, por lo que para resolver el sistema se asume que $\phi(\mathbf{r})$ y $\partial_{\hat{\mathbf{n}}}\phi(\mathbf{r})$ son constantes, permitiendo sacarlas de las integrales correspondientes; como toda la formulación se realiza sobre la interfaz, se necesita calcular la interacción de la superficie de la molécula consigo misma\footnote{En casos en que haya más de una superficie, es necesario calcular las combinaciones entre todas ellas.}. Omitiendo el subíndice $2$, para un panel de referencia $v$, la interacción con cada uno de los $N-1$ paneles restantes (aquí con subíndice $w$), \textbf{y} consigo mismo se muestra a continuación
\begin{flalign*}
\frac{\phi(\mathbf{r}_v)}{2} + \phi(\mathbf{r}_v)\sum_{w=0}^N \int_{\partial\Omega_v}\left(\frac{\partial}{\partial\hat{\mathbf{n}}}G_L(\mathbf{r}_v, \mathbf{r}_w)\right)\, d\partial\Omega_v\, - & \\
\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r}_v)\right) \sum_{w=0}^N\int_{\partial\Omega_v} G_L(\mathbf{r}_v, \mathbf{r}_w)\, d\partial\Omega_v = \frac{1}{4\pi\varepsilon_p}\sum_{j = 1}^{N_q}\frac{q_j}{|\mathbf{r}_v - \mathbf{r}_j|}& \numberthis
\end{flalign*}
\begin{flalign*}
\frac{\phi(\mathbf{r}_v)}{2} + \phi(\mathbf{r}_v)\sum_{w=0}^N \int_{\partial\Omega_v} \left(\frac{\partial}{\partial\hat{\mathbf{n}}}G_R(\mathbf{r}_v, \mathbf{r}_w)\right)\, d\partial\Omega_v \, - & \\
\left(\frac{\partial}{\partial\hat{\mathbf{n}}}\phi(\mathbf{r}_v)\right) \sum_{w=0}^N \int_{\partial\Omega_v} G_R(\mathbf{r}_v, \mathbf{r}_w)\, d\partial\Omega_v = 0 & \numberthis
\end{flalign*}
Como este par de ecuaciones resuelve el sistema para un panel, y la superficie discretizada se compone de $N$ paneles, la forma matricial del sistema de ecuaciones que rige para todo el borde queda
\begin{equation}\label{eqn:Mem_matrix_form}
\begin{bmatrix}
\frac{\mathbb{I}}{2} + K_L & -V_L \\ \frac{\mathbb{I}}{2} - K_M & V_M
\end{bmatrix}
\begin{bmatrix}
\phi \\ \frac{\partial}{\partial\hat{\mathbf{n}}}\phi
\end{bmatrix} = 
\begin{bmatrix}
\frac{1}{4\pi\varepsilon_p}\sum_{j = 1}^{N_q}\frac{q_j}{|\mathbf{r} - \mathbf{r}_j|} \\
0
\end{bmatrix}
\end{equation}
El cálculo de los Single y Double Layer Potentials requiere a su vez la discretización del panel para el cómputo numérico de las integrales, lo que supone en este caso distribuir $k_G$ puntos de Gauss sobre un panel para calcular los valores de los integrandos en dichos puntos; $k_G$ varía según si se consideran paneles lejanos, cercanos, o cuando corresponde usar un método semianalítico. Como ejemplo, para los operadores que consideran la ecuación de Laplace por fuera de la molécula, se tiene

\begin{align*}
V_{v,w}^M &= A_v\cdot\sum_{k=1}^{k_G}\sum_{i=-n}^{n}\frac{\omega_k\cdot q_i}{4\pi|\mathbf{r}_w - \mathbf{r}_{v,k,i}^*|} \numberthis\\
K_{v,w}^M &= A_v\cdot\sum_{k=1}^{k_G}\sum_{i=-n}^{n}\nabla\left(\frac{\omega_k\cdot q_i}{4\pi|\mathbf{r}_w - \mathbf{r}_{v,k,i}^*|}\right)\cdot\hat{\mathbf{n}} \\
&= A_v\cdot\sum_{k=1}^{k_G}\sum_{i=-n}^{n}\frac{\omega_k\cdot q_i}{4\pi}\cdot\nabla\left(\frac{1}{|\mathbf{r}_w - \mathbf{r}_{v,k,i}^*|}\right)\cdot\hat{\mathbf{n}}\numberthis
\end{align*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%REVISAR SI LO SIGUIENTE, SOBRE EL TAMAÑO DE LA MATRIZ, ESTA BIEN!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent
Aquí, $\omega_k$ son los pesos de la cuadratura Gaussiana, $q_i$ mantiene su definición según \ref{eqn:RIC_terms} con carga $q = 1$, $\mathbf{r}_{v,k,i}^*$ es la posición de la $i$-ésima imagen del $k$-ésimo punto de cuadratura del panel $v$, y $A_v$ es el área de dicho panel.\\\\
Lo anterior aplica para el panel $v$ como \texttt{src} y $w$ como \texttt{tar} (es decir, se esta calculando el potencial debido a $v$ en el punto de colocación del panel $w$), por lo que cada término en la matriz del sistema \ref{eqn:Mem_matrix_form} tiene dimensiones de la cantidad de paneles objetivo $\times$ cantidad de paneles fuente, y el sistema completo tiene una cantidad de $2\times$(paneles objetivo $\times$ paneles fuente) elementos. El método recién explicado funciona bien cuando los paneles objetivo están a una cierta distancia del panel fuente; en general, estando a más de $10^{-10} [\angstrom]$, no se tienen problemas. Esto es, para paneles \textit{lejanos} se utilizan pocos puntos de cuadratura, para paneles bajo cierto umbral pero que aún no están bajo los mencionados $10^{-10} [\angstrom]$, simplemente se aumenta la densidad de puntos.\\\\
Distinto es el caso del panel propio, que requiere la mencionada integración semianalítica, pues las distancias serían muy pequeñas entre los puntos de cuadratura y el centro del panel (distancia \texttt{tar} - \texttt{src}), y el denominador de las funciones de Green se volvería prácticamente cero. Esta forma de integración se utiliza, en el caso del método de imágenes, para el término 0 del contador, pues todos los demás están al menos a una distancia $(a - z_0)$ con respecto al punto de cuadratura; $z_0$ es la tercera coordenada del punto de cuadratura.\\\\
El método que se utiliza para integrar de forma semianalítica se inicia tomando el punto de colocación y proyectándolo sobre el plano del panel \cite{Zhu}. Esto permite formar tres triángulos ($\Delta_{O12}$, $\Delta_{O23}$, $\Delta_{O13}$). Al trabajar una función que se quiera integrar sobre este grupo de triángulos en coordenadas polares, se puede integrar analíticamente en la variable $r$, de tal forma que solo es necesario variar el ángulo de integración para recorrer cada uno de los tres lados de cada triángulo del conjunto, como se muestra a continuación en la figura \ref{Fig:Fig_6}.

\begin{figure}[h]
\centering
\input{./Figures/Fig_6.eps_tex}
\caption{Aplicación del método semianalítico sobre un panel triangular.}\label{Fig:Fig_6}
\end{figure}

\noindent
La integral de la función ($f(r,\theta)$ en la ecuación (\ref{eqn:semianalytical_int})) sobre el panel es entonces la suma de las integrales por separado sobre cada triángulo, de tal forma que para el caso ejemplo de la figura \ref{Fig:Fig_6} y siendo consistente con el sentido en que se recorren los triángulos, se tiene
\begin{align*}
\iint_{\Delta_{123}}f(r,\theta)\, dA =& \int_{\Delta_{123}}f(\theta)\, d\theta \\
= \int_{\Delta_{O12}}f(\theta)\, d\theta\, \, + & \int_{\Delta_{O23}}f(\theta)\, d\theta - \int_{\Delta_{O13}}f(\theta)\, d\theta& \numberthis \label{eqn:semianalytical_int}
\end{align*}
La magnitud del radio es entonces la suma $H + |\mathbf{r}_\theta|$, donde $H$ es la distancia normal entre el punto de colocación y el plano de proyección, y $\mathbf{r}_\theta$ es la distancia entre dicha proyección y el lado del triángulo que se está calculando. Las integrales de línea que quedan son discretizada con cuadratura de Gauss. Los operadores Single y Double Layer para el panel singular son, para el caso de Laplace, los siguientes (\cite{Hess})
\begin{gather}
V_L = \sum_{lados}\sum_{k=1}^{K_G}\omega_k\cdot (|\mathbf{r}(\theta_k)| - |H|)\cdot\frac{\theta}{2}\\
K_L = \sum_{lados}\sum_{k=1}^{K_G}\omega_k\cdot \left(\frac{H}{|\mathbf{r}(\theta_k)|}\right) - \text{sign}(H) \cdot\frac{\theta}{2}
\end{gather}
Se tienen así los valores, calculados numéricamente, de los Single y Double Layer Potentials en todos los paneles para una (macro)molécula embebida en una membrana con solvente fuera. El siguiente paso es proceder a formar la matriz del sistema de ecuaciones y proseguir con la secuencia descrita en la sección \ref{Sec:SW_Description} para \texttt{PyGBe}.\\\\
La inclusión del método de imágenes para cálculos con membrana en \texttt{PyGBe} significó la modificación de una serie de archivos para permitir al programa leer las propiedades de la bicapa (espesor y permitividad), seleccionar el tipo de cálculo que se requiere (PB o método de imágenes), y el número de imágenes en el método, entre otros. Se procede por tanto a presentar los resultados del método y lo relativo a la labor de cómputo realizada, pero previo a esto se introduce una herramienta que facilita de gran forma el trabajo de entendimiento y comparación de los programas.
%Se presentan estas modificaciones y una descripción (cuando se considere necesario) como Anexo. 

%
%\subsection{Definición de límites para las sumatorias (cálculo computacional de $\infty$)}
%Las Ecs. (29) y (30) contemplan sumatorias que van desde $-\infty$ a $\infty$, cosa que a nivel computacional no es posible lograr. Para eso y sabiendo que la sumatoria converge al tener un denominador que va aumentando, se puede buscar un número $n < \infty$ que resulte representativo. Se trabaja con un código simple hecho en \texttt{Python 3}, a través de la interfaz \texttt{Jupyter}. Se buscan dos valores de $n$ consecutivos tales que la diferencia porcentual entre los potenciales para cada n sea baja. Aquí $n$ corresponde a $+\infty$ y $-n$ a $-\infty$. Se evalúa la Ec. (29) con $n = 48$ y luego con $n=50$, siendo la diferencia relativa entre estos dos valores igual a $0.00936287...\%$. Además se evalúa para valores de $n = 68$ y $n=70$, lo que da un $\Delta$ porcentual de $0.00225061...\%$. Esto se calcula mediante
%\begin{equation*}
%\frac{\phi_{(n)} - \phi_{(n-1)}}{\phi_{(n-1)}}\cdot 100\%
%\end{equation*}
%Se tiene entonces un claro indicio de que aumentar el valor de $n$ mucho más allá de $50$ no es realmente útil e implica dedicar más recursos computacionales. Se presenta a continuación una gráfica para un valor de $q=1$, $\epsilon_1 = 80$ y $\epsilon_2 = 2$. La primera constante dieléctrica corresponde a la del medio externo, y la segunda a la del medio encerrado. La posición de la carga de prueba es $(0,0,0)$, y la del punto de evaluación es $(1,0,0)$ en coordenadas cartesianas. En esta gráfica se puede apreciar cómo la Ec. (29) converge a un valor del potencial $\phi$ a medida que aumenta $n$, hasta un punto en que prácticamente ya no hay diferencia. El valor para $n=120$ es $\phi = 0.0253427...\approx 0.025343$.
%
%\begin{figure}[H]
%\centering
%\includegraphics[width=\linewidth]{./Imagenes/phi_n.png}
%\caption{Convergencia del valor del potencial en función de $n$.}
%\end{figure}
%\noindent
%Se presenta también la diferencia porcentual entre los cálculos para distintos valores de $n$ en la Figura 6, con escala logarítmica en el eje de la variación para poder distinguir de mejor forma los cambios en el valor. Como ya se dijo y también como se puede ver en cualquiera de las dos gráficas, no merece la pena calcular para $n$ mucho mayores a 50, pues es poca la precisión que se gana, y para conjuntos de múltiples cargas se produce una demanda computacional innecesaria.\\\\
%Se puede observar que, teniendo en cuenta la escala logarítmica, la diferencia entre iteraciones después de la marca roja tiende a ser lineal, por lo que no se gana mucho aumentando el número de datos. Es para tener mayor certeza de la precisión del cálculo que se propone trabajar con $n = 70$. 
%\begin{figure}[H]
%\centering
%\includegraphics[width=\linewidth]{./Imagenes/delta_n.png}
%\caption{Variación porcentual del valor de $\phi$ en función de $n$.}
%\end{figure}
%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{El ciclo termodinámico en solvatación}
En el cálculo de energías de solvatación es muy útil analizar los estados en que se encuentra el sistema en cuestión. Para esto se realiza un ciclo termodinámico, que facilita el entendimiento de lo que se está calculando. En este trabajo se utiliza principalmente para entender justamente qué son los resultados que se estan obteniendo, y compararlos con el programa \texttt{APBSmem}.\\\\
Para el caso trabajado, el ciclo termodinámico común para \texttt{APBSmem} y \texttt{PyGBe} es el que se muestra en la figura \ref{fig:thermo_cycle} y que consiste de cuatro estados. El estado \circled{1} es la membrana y el conjunto de cargas que componen la molécula, por separado, en el vacío\footnote{Para efectos de ambos programas, el ``vacío" es en realidad un medio dieléctrico polarizable de permitividad igual a la de la molécula.}; como la membrana es un dieléctrico que no posee cargas explícitas, no hay una energía electrostática asociada, y para el caso del conjunto de cargas, la energía es simplemente la de Coulomb en el medio (ecuación (\ref{eqn:potential})). El estado \circled{2} corresponde a la membrana y el conjunto de cargas, nuevamente por separado, pero esta vez en agua en vez de en el vacío. La proteína y la membrana mantienen sus permitividades, por lo que en este caso hay una condición de salto en el borde de la proteína (ecuación (\ref{eqn:jump_condition})). El estado \circled{3} es un sistema en que la molécula esta embebida en la membrana, y este conjunto esta a su vez en el vacío; las permitividades de este último y la de la molécula siguen siendo iguales entre sí. Finalmente, el estado \circled{4} es semejante al estado \circled{3}, pero por fuera del conjunto membrana-proteína hay agua con su respectiva permitividad. Las diferencias energéticas de la \circled{A} a la \circled{E} se detallan a continuación.

\begin{table}[h]\label{table:thermo_cycle_details}
	\centering
	\caption{Expresión de las diferencias energéticas, en función de los estados 1 a 4. $\Delta G$ es la diferencia en la energía de Gibbs entre los distintos estados del ciclo \ref{fig:thermo_cycle}.}
	\setlength{\tabcolsep}{30pt}
	\begin{tabular}{cc}
		\circled{A} & $\Delta G_{\circled{2} - \circled{1}}$ \\
		\circled{B} & $\Delta G_{\circled{3} - \circled{1}}$ \\
		\circled{C} & $\Delta G_{\circled{4} - \circled{2}}$ \\
		\circled{D} & $\Delta G_{\circled{4} - \circled{3}}$ \\
		\circled{E} & $\Delta G_{\circled{4} - \circled{1}}$
	\end{tabular}
\end{table}

\noindent
Se debe resaltar que, como en cualquier ciclo termodinámico, un camino cerrado suma cero si se es consistente. Esta propiedad es sumamente importante, pues \texttt{PyGBe} solo puede calcular directamente diferencias de energías que involucren el estado \circled{1} en la figura \ref{fig:thermo_cycle}; gracias a que un camino cerrado da cero, se pueden calcular las diferencias de energía faltantes - en este caso \circled{C} y \circled{D} - a partir del resto del ciclo.
\begin{figure}[h]
	\centering
	\input{./Figures/Fig_9.eps_tex}
	\caption{Ciclo termodinámico estudiado según lo presentado en los párrafos anteriores. Lo que se calcula con \texttt{PyGBe} y \texttt{APBS} es la diferencia $1\rightarrow 4$.}% \circled{E}.}
	\label{fig:thermo_cycle}
\end{figure}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\chapter{Resultados}
En primer lugar se recuerda que la meta de todo este trabajo es simular energías de solvatación de proteínas embebidas en membranas, analizando tres casos simples y contrastando resultados con un programa ampliamente aceptado y usado (\texttt{APBS} y \texttt{APBSmem}), tanto en términos de precisión del cálculo como en tiempo de cómputo requerido. Los tres casos simples son un ion de carga unitaria, un arreglo de tres iones, todos de carga unitaria, uno de ellos de radio tal que encierra a los otros, y el tercer caso es una molécula de bromoetano (Apéndice \ref{Anexo:Bromoethane}).
\section{Cálculo numérico de las energías}
Las pruebas se realizaron con una membrana de espesor $a = 20\, \angstrom$, con una de las dos interfaces ubicada en el plano $z=-10\, \angstrom$ respecto del origen $(0,0,0)$ en coordenadas cartesianas, y la otra en $z = 10\, \angstrom$.\\\\%Las permitividades se presentan en la Tabla 1, a continuación
%\begin{table}[H]
%\setlength{\tabcolsep}{32pt}
%\centering
%\caption{Permitividades de los tres medios trabajados}
%\begin{tabular}{ccc}\hline
%$\varepsilon_m = 2$ & $\varepsilon_p = 4$ & $\varepsilon_w = 80$\\\hline
%\end{tabular}
%\end{table}
%\noindent
Las permitividades están adimensionalizadas, su valor siendo el descrito en el apartado \ref{subsec:Macro_perm}. Los subíndices son, respectivamente de izquierda a derecha, indicadores de \textit{membrane (membrana)}, \textit{protein (proteína)} y \textit{water (agua)}.\\\\
Los cálculos se realizan para tres densidades de malla, para los tres casos de prueba, y para los dos programas - \texttt{PyGBe} y \texttt{APBSmem}. Los cálculos realizados corresponden a la diferencia \circled{4} - \circled{1} en el ciclo termodinámico \ref{fig:thermo_cycle}, con las siguientes propiedades

\begin{table}[h]
	\setlength{\tabcolsep}{32pt}
	\centering
	\caption{Permitividades en los estados de interés.}
	\def\arraystretch{1.2}
	\begin{tabular}{|cccc|}\hline
		Estado & $\varepsilon_m$ & $\varepsilon_p$ & $\varepsilon_w$\\\hline
		\circled{1} & - & 4.0 & 4.0 \\
		\circled{4} & 2.0 & 4.0 & 80.0 \\ \hline
	\end{tabular}
\end{table}

\subsection{Resultados mediante PyGBe}\label{subsec:resultados_pygbe}
Para calcular las energías de solvatación con PyGBe, se utiliza \texttt{MSMS} para generar las mallas en archivos de formato \texttt{.vert} y \texttt{.face}, como se explica en la sección \ref{Sec:SW_Description}. Se crean tres mallas por caso de estudio; la densidad de elementos se aumenta a una tasa constante para poder realizar un análisis mediante extrapolación de Richardson, como se presenta más adelante. Los casos estudiados son \texttt{centered\_ion}, \texttt{3q} y \texttt{bromoethane}. El primer caso es un único ion en (0,0,0) de radio $4\,\angstrom$, el segundo son 3 iones, uno de radio $4\,\angstrom$ en (0,0,0) y los otros de radio $1\,\angstrom$ ubicados completamente dentro del volumen del primer ion, y el tercer caso es una molécula de 8 átomos con diversos radios y cargas. Las densidades de elementos de borde utilizadas, en $\frac{vert}{\angstrom^2}$, son 2, 4 y 8.\\\\
Para calcular los siguientes resultados se utilizaron 3 puntos de cuadratura para elementos lejanos, 37 en los paneles cercanos, y 9 puntos para el caso semianalítico. Además, el número de imágenes se mantuvo constante en $n=41$ para estas pruebas; más adelante se presenta un análisis en función de variar el parámetro $n$ para ver cómo es la convergencia. Para el caso del bromoetano, como la molécula tiene una superficie menor (y por ende tiene menos paneles), se decide aumentar el número de imágenes a $n=61$. Esto para mejorar la precisión y porque el consumo de memoria lo permite.
Sobre el primer caso, \texttt{centered\_ion}, se presentan a continuación las energías de solvatación (Esolv) obtenidas para las 3 mallas, junto con los tiempos de cálculo totales y la memoria utilizada. Se puede ver que la convergencia es proporcional a la de \texttt{PyGBe} sin membrana.

\begin{table}[h]
	\centering
	\caption{Energías de solvatación calculadas, tiempos de cálculo y memoria RAM utilizada para los cómputos según la densidad de malla probada, para el archivo \texttt{centered\_ion}.}
	\def\arraystretch{1.2}
	\begin{tabular}{|cccccc|}\hline
		\multirow{2}{*}{Densidad} & Número de & \multirow{2}{*}{Esolv (PyGBe)} & Esolv (PyGBe & Tiempo de & RAM\\
		 & elementos &  & + Membrana) & cálculo & utilizada\\\hline
		vert.$/\angstrom^2$ & \rule{0pt}{15pt}[-] & kcal/mol & kcal/mol & [s] & [GB] \\\hline
		d02 & 736 & -9.919124 & 5.258441 & 45.146 & 3.6\\
		d04 & 1572 & -9.886872 & 5.243907 & 176.890 & 15.9\\
		d08 & 3124 & -9.872508 & 5.236550 & 696.899 & 63.9 \\ \hline
	\end{tabular}\label{table:pygbe_centered_ion}
\end{table}
\noindent
Para el segundo caso, \texttt{3q}, las energías son mayores, por lo que como se ve más adelante, el error relativo es bastante menor que en el caso anterior (\texttt{centered\_ion}) y el que se ve después (\texttt{bromoethane}). A continuación se presenta una tabla (\ref{table:pygbe_3q}) equivalente a la anterior, pero en este caso solo se presentan las energías, pues los tiempos y la memoria consumidos varían muy poco ya que la discretización de la superficie es la misma que en el caso anterior.\\

\begin{table}[h]
	\centering
	\caption{Energías de solvatación calculadas según la densidad de malla para el archivo \texttt{3q}.}
	\def\arraystretch{1.2}
	\begin{tabular}{|cccc|}\hline
		\multirow{2}{*}{Densidad} & Número de & \multirow{2}{*}{Esolv (PyGBe)} & Esolv (PyGBe \\
		& elementos &  & + Membrana) \\\hline
		\rule{0pt}{15pt} vert.$/\angstrom^2$ & [-] & kcal/mol & kcal/mol \\\hline
		d02 & 736 & -90.703972 & 47.973011 \\
		d04 & 1572 & -90.391445 & 47.841024 \\
		d08 & 3124 & -90.252742 & 47.774469 \\ \hline
	\end{tabular}\label{table:pygbe_3q}
\end{table}
\noindent
Finalmente, para la molécula de bromoetano se presenta nuevamente una tabla como \ref{table:pygbe_centered_ion}, pues la geometría en este caso es distinta a una esfera y se debió realizar un mapeo diferente. La molécula tiene un área menor, lo que se traduce en un tiempo de cálculo y consumo de memoria menores para la misma densidad de elementos. Para este caso se omite la extrapolación de Richardson debido a que los resultados de los cálculos no están en sucesión creciente o decreciente, sino que se podría decir que oscilan, por lo que dicho método de extrapolación no es realmente aplicable. La tabla de resultados en cuestión es la siguiente:

\begin{table}[h]
	\centering
	\caption{Energías de solvatación calculadas, tiempos de cálculo y memoria RAM para cada una de las tres mallas de la molécula de \texttt{bromoethane}.}
	\def\arraystretch{1.2}
	\begin{tabular}{|cccccc|}\hline
		\multirow{2}{*}{Densidad} & Número de & \multirow{2}{*}{Esolv (PyGBe)} & Esolv (PyGBe & Tiempo de & RAM\\
		& elementos &  & + Membrana) & cálculo & utilizada\\\hline
		\rule{0pt}{15pt} vert.$/\angstrom^2$ & [-] & kcal/mol & kcal/mol & [s] & [GB] \\\hline
		d02 & 322 & -0.348698 & 0.218434 & 17.852 & 1.0\\
		d04 & 694 & -0.339504 & 0.221408 & 60.248 & 4.1\\
		d08 & 1448 & -0.339504 & 0.220199 & 224.459 & 19.2\\ \hline
	\end{tabular}\label{table:pygbe_bromoethane}
\end{table}


\subsection{Resultados mediante APBS - APBSmem}\label{subsec:resultados_apbs}

Para poder validar los resultados obtenidos con \texttt{PyGBe} se requiere una referencia contra la cual comparar. El software \texttt{APBSmem} se utiliza para este propósito, en vista de su renombre. Ahora bien, el programa lo que hace es parcelar una ``caja" (el dominio de integración) en nodos en los que calcula, dependiendo de la ubicación y condiciones de dicho nodo, la ecuación gobernante correspondiente. Por eso es que se requiere setear condiciones en los bordes de la mencionada caja. \texttt{APBSmem}, al igual que \texttt{APBS}, permite establecer dichas condiciones. Para el caso trabajado existen tres, que son explicados en el apartado \ref{subsec:APBS}. Se presentan por ende tres tablas para el caso del archivo \texttt{centered\_ion}, dos para el caso \texttt{3q} (se explica el por qué al presentar los resultados), y el valor de evaluación más fino para la molécula de \texttt{bromoethane}, en vista que se omite la extrapolación de Richardson para esta molécula.\\\\
Como en \texttt{APBSmem} hay que definir un dominio de integración rectangular, se opta por uno cúbico de $128\,\angstrom$ de lado, con tres cantidades de elementos de modo que cada uno de estos sea de $0.25\,\angstrom, 0.5\,\angstrom$ y $1\,\angstrom$; de esta forma se mantiene una tasa de refinación de malla constante. Se utiliza \texttt{APBS} con mapas dieléctricos modificados para incluir la membrana, y el programa entrega la misma diferencia que \texttt{PyGBE}, pero en unidades de $kJ/mol$. Esto no requiere más que una división por $4.184\, kJ/kcal$ para hacer los resultados directamente comparables. Siguiendo el mismo orden que para \texttt{PyGBe}, los resultados para el primer caso de estudio son los siguientes

\begin{table}[h]
	\centering
	\caption{Resultados, tiempos de cálculo y RAM utilizada para el cálculo sobre el archivo \texttt{centered\_ion}, mediante APBS.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|cccccc|}\hline
		\multirow{2}{*}{Tipo de} & \multirow{2}{*}{$\Delta$x} & Número de & \multirow{2}{*}{Esolv} & \multirow{2}{*}{Esolv} & Tiempo de & RAM\\
		\multirow{2}{*}{condición} &  & elementos &  &  & cálculo & utilizada\\ \cline{2-7}
		&  $\angstrom$ & [-] & kJ/mol & kcal/mol & [s] & [GB] \\\hline
		\parbox[t]{2mm}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\texttt{zero}}}} & 1.00 & 128 & 22.65401 & 5.41420 & 16.548 & 0.5\\
		& 0.50 & 256 & 22.46140 & 5.36840 & 131.126 & 3.8\\
		& 0.25 & 512 & 22.30540 & 5.33112 & 1208.873 & 29.7\\ \hline
		\parbox[t]{2mm}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\texttt{sdh}}}} & 1.00 & 128 & 20.39885 & 4.87544 & 16.872 & 0.5\\
		& 0.50 & 256 & 20.20733 & 4.82967 & 132.265 & 3.8\\
		& 0.25 & 512 & 20.05135 & 4.79239 & 1150.529 & 29.7\\ \hline
		\parbox[t]{2mm}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\texttt{mdh}}}} & 1.00 & 128 & 20.39885 & 4.87544 & 16.361 & 0.5\\
		& 0.50 & 256 & 20.20733 & 4.82967 & 134.597 & 3.8\\
		& 0.25 & 512 & 20.05135 & 4.79239 & 1226.290 & 30.8\\ \hline
	\end{tabular}\label{table:apbs_centered_ion}
\end{table}

\noindent
A continuación se muestran los resultados para \texttt{3q}, y la razón de solo presentar dos sets de resultados para esta molécula es que se repite el comportamiento apreciado en la tabla anterior, \ref{table:apbs_centered_ion}; las energías de solvatación para las condiciones \texttt{sdh} y \texttt{mdh} no varían, probablemente porque los casos de estudio son muy simples. Por esto es que únicamente se presentan los datos correspondientes a condiciones de contorno \texttt{zero} y \texttt{sdh}.
\begin{table}[h]
	\centering
	\caption{Resultados, tiempos de cálculo y RAM utilizada para las tras mallas en el caso de estudio \texttt{3q}, mediante APBS.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|cccccc|}\hline
		\multirow{2}{*}{Tipo de} & \multirow{2}{*}{$\Delta$x} & Número de & \multirow{2}{*}{Esolv} & \multirow{2}{*}{Esolv} & Tiempo de & RAM\\
		\multirow{2}{*}{condición} &  & elementos &  &  & cálculo & utilizada\\\cline{2-7}
		&  $\angstrom$ & [-] & kJ/mol & kcal/mol & [s] & [GB] \\\hline
		\parbox[t]{2mm}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\texttt{zero}}}} & 1.00 & 128 & 207.06438 & 49.48957 & 23.602 & 0.6 \\
		& 0.50 & 256 & 204.90048 & 48.97239 & 137.004 & 4.0 \\
		& 0.25 & 512 & 203.40408 & 48.61474 & 1174.478 & 29.9 \\ \hline
		\parbox[t]{2mm}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\texttt{sdh}}}} & 1.00 & 128 & 186.77688 & 44.64074 & 23.958 & 0.6 \\
		& 0.50 & 256 & 184.61382 & 44.12376 & 127.519 & 3.9 \\
		& 0.25 & 512 & 183.11772 & 43.76619 & 1093.347 & 29.9 \\ \hline
	\end{tabular}\label{table:apbs_3q}
\end{table}

\noindent
En vista que no se puede comparar una extrapolación con \texttt{PyGBe}, para el caso de la molécula de bromoetano se presenta simplemente el valor calculado con la malla más refinada en \texttt{APBSmem}; esto para condiciones \texttt{zero} y \texttt{sdh}.

\begin{table}[h]
	\centering
	\caption{Resultado, tiempo de cálculo y RAM utilizada para la malla más fina en el caso de estudio de \texttt{bromoethane}, mediante APBS.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|cccccc|}\hline
		\multirow{2}{*}{Tipo de} & \multirow{2}{*}{$\Delta$x} & Número de & \multirow{2}{*}{Esolv} & \multirow{2}{*}{Esolv} & Tiempo de & RAM\\
		\multirow{2}{*}{condición} &  & elementos &  &  & cálculo & utilizada\\\cline{2-7}
		&  $\angstrom$ & [-] & kJ/mol & kcal/mol & [s] & [GB] \\\hline
	\texttt{zero} & 0.25 & 512 & 0.90307 & 0.21584 & 1194.226 & 30.8 \\
	\texttt{sdh} & 0.25 & 512 & 0.90299 & 0.21582 & 1206.741 & 29.7 \\ \hline
	\end{tabular}\label{table:apbs_brom}
\end{table}

\section{Extrapolación de Richardson y convergencia}
Para poder comprobar de manera fehaciente que utilizar el método de imágenes acoplado a \texttt{PyGBe} es una forma válida de simular una proteína embebida en una membrana, se utiliza una extrapolación de Richardson para comparar los cálculos obtenidos con los dos programas. La extrapolación de Richardson es una herramienta que permite, como indica el nombre, realizar una extrapolación mediante tres puntos para obtener el valor teórico de convergencia si la malla se afinara consecutivamente a una tasa constante. Es por esta razón que todos los cálculos realizados previamente presentan un refinamiento de malla constante. La fórmula para obtener el resultado teórico extrapolado es

\begin{equation}\label{eqn:Richardson_ext}
G_t = \frac{G_1\cdot G_3 - (G_2)^2}{G_1 - 2G_2 + G_3}
\end{equation}

\noindent
Para esto se debe cumplir que $d = \Delta x_3:\Delta x_2 = \Delta x_2:\Delta x_1$, donde $G_i = G(\Delta x_i)$. Además de calcular el valor teórico extrapolado, se calcula la tasa de convergencia, que nos indica qué tan rápido converge el programa a dicha solución; mientras mayor el valor, mejor es la tasa de convergencia. La fórmula para esto es

\begin{equation}\label{eqn:convergence_rating}
	P = \dfrac{\ln{\left(\dfrac{G_3 - G_2}{G_2 - G_1}\right)}}{\ln{(d)}}
\end{equation}

\noindent
Con este método aclarado es que se presentan los resultados extrapolados para los casos de estudio (\texttt{centered\_ion} y \texttt{3q}), así como también una comparación porcentual entre los resultados extrapolados obtenidos mediante \texttt{PyGBe} y \texttt{APBS - APBSmem}. Para el caso de \texttt{bromoethane} se calcula una diferencia porcentual entre los resultados para las mallas más finas solamente. Como \texttt{APBSmem} tiene dos resultados distintos (tres en realidad, pero se utilizan solo \texttt{zero} y \texttt{sdh} por los motivos explicados previamente) dependiendo de las condiciones de contorno utilizadas, se presentan dos errores porcentuales; sin embargo, se adelanta que el menor error corresponde a la condición de borde \texttt{zero} en todos los casos estudiados. La razón principal que provoca esto, por lo que se infiere, se desarrolla en la sección de análisis de los resultados obtenidos. Los valores extrapolados calculados con la fórmula \ref{eqn:Richardson_ext} - para el bromoetano el valor de la malla más fina - se presentan en la tabla \ref{table:Rich_extrapolation}

\begin{table}[h]
	\centering
	\caption{Valores teóricos extrapolados mediante extrapolación de Richardson de los distintos casos de estudio.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|ccc|}\hline
		 & \texttt{centered\_ion} & \texttt{3q} & \texttt{bromoethane} \\ \hline
		\texttt{PyGBe} & 5.22901 & 47.70677 & 0.22020 \\ \hline
		\texttt{APBSmem zero} & 5.16772 & 47.81296 & 0.21584 \\ \hline
		\texttt{APBSmem sdh} & 4.62880 & 42.96407 & 0.21582 \\ \hline
	\end{tabular}\label{table:Rich_extrapolation}
\end{table}

\noindent
También se muestran a continuación las tasas de convergencia según la fórmula \ref{eqn:convergence_rating}; con esta información podemos ver la rapidez con la que los cálculos hechos convergen al resultado extrapolado, y sirve como herramienta también para discernir qué tan bueno es el modelo utilizado; mientras mayor el valor, más rápida es la convergencia.

\begin{table}[h]
	\centering
	\caption{Convergencia al valor teórico extrapolado de los resultados, para PyGBE y las dos condiciones importantes de APBS.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|ccc|}\hline
		& \texttt{centered\_ion} & \texttt{3q} & \texttt{bromoethane} \\ \hline
		\texttt{PyGBe} & 0.98224 & 0.98778 & - \\ \hline
		\texttt{APBSmem zero} & 0.29655 & 0.53213 & - \\ \hline
		\texttt{APBSmem sdh} & 0.29617 & 0.53186 & - \\ \hline
	\end{tabular}\label{table:Convergence_ratings}
\end{table}

\section{Análisis de Resultados}\label{Sec:analisis_resultados}

Teniendo los valores de la tabla \ref{table:Rich_extrapolation}, se pueden calcular las diferencias porcentuales entre los resultados para cada código. Como la idea es utilizar \texttt{APBSmem} para validar los valores obtenidos con \texttt{PyGBe}, se presentan las diferencias entre estos y los de las dos condiciones de contorno para \texttt{APBS}.

\begin{table}[h]
	\centering
	\caption{Diferencia de PyGBe con inclusión de membrana, con las dos condiciones de contorno de APBS.}
	\def\arraystretch{1.2}
	\begin{tabular}{|c|ccc|}\hline
		& \texttt{centered\_ion} & \texttt{3q} & \texttt{bromoethane} \\ \hline
		\texttt{APBSmem zero} & 1.18597 & 0.22209 & 2.01983 \\ \hline
		\texttt{APBSmem sdh} & 12.96685 & 11.03877 & 2.02894 \\ \hline
	\end{tabular}\label{table:Percent_Error}
\end{table}

\noindent
Como se adelantó en la sección anterior, las menores diferencias se obtienen cuando se fija una condición de borde tipo \texttt{zero} en \texttt{APBSmem}. Físicamente, la condición de contorno \texttt{sdh} debiese considerar el efecto del campo de reacción del medio más allá de las interfaces para ser válido, pues existe un salto causado por la membrana que tanto esta condición como \texttt{mdh} no toman en cuenta. Distinto es el caso de una condición \texttt{zero}, que solo requiere un dominio de integración grande, ya que independiente de la reacción del medio, el potencial en cualquier dirección tiende a $0$ a medida que aumenta la distancia a las cargas que lo generan.\\\\
La idea es que el error respecto de \texttt{APBSmem} sea lo menor posible, por supuesto; de preferencia se apuntaba a un error menor a $2\%$, y se comprueba en la tabla \ref{table:Percent_Error} que esto se cumple en los dos primeros casos de estudio. Es difícil lograr un error menor en el caso del bromoetano, pues las energías de solvatación son muy pequeñas comparadas con \texttt{centered\_ion} y \texttt{3q}.\\\\
Con los resultados para $n=41$ cargas imagen ya tabulados, corresponde realizar un análisis de sensibilidad para ver qué tanto influye el número de imágenes y determinar un valor óptimo. También se muestra a partir del estudio de esta variable que $n=41$ es suficiente para el espectro que cubre este trabajo. Para esto se utiliza el caso del ion centrado con 1572 elementos de borde (d04), por razones de costo computacional principalmente. Se estudia el rango de la variable entre $[21,61]$, yendo en aumentos de 2 $(21, 23, 25...)$ y se presentan tanto las energías para el caso del ion centrado como las diferencias porcentuales entre distintos $n$. Se recuerda que, como ejemplo, $n=21$ significa que hay $10$ imágenes por arriba ($+z$), $10$ por abajo ($-z$), y el punto de cuadratura mismo (término $i = 0$ en la sumatoria \ref{eqn:RIC_single}).

\begin{figure}[h]
	\centering
	\includegraphics[scale = 0.45]{./Figures/Potencial}
	\caption{Resultados de PyGBE con membrana para el caso \texttt{centered\_ion}, según se varía el número de cargas imagen del método. La línea roja es el resultado extrapolado para $41$ cargas imagen.}\label{graph:Potencial}
\end{figure}

\noindent
Viendo el gráfico \ref{graph:Potencial}, resulta evidente la naturaleza oscilatoria de la convergencia, lo que no es anormal en modelos de este tipo; el método de imágenes es, a fin de cuentas, una expansión cuyo signo va variando término a término. La línea horizontal roja indica el valor extrapolado mediante la fórmula de Richardson, y la idea es mostrar que este no difiere significativamente del valor al que tiende a converger el potencial. A pesar de lo bueno de este hecho, también se puede apreciar que el valor extrapolado fue trabajado con $n=41$ y es clara su cercanía justamente al potencial con ese número de cargas imagen. Por otro lado, se ve que dentro de todo la convergencia no es rápida, y para asegurar un resultado con un buen nivel de precisión se requieren muchos términos en la sumatoria.

\begin{figure}[h]
	\centering
	\includegraphics[scale = 0.45]{./Figures/Error}
	\caption{Variación porcentual en el resultado, en función del número de imágenes empleado. La línea roja es el resultado extrapolado para $41$ cargas imagen.}\label{graph:Error}
\end{figure}

\noindent
Del gráfico \ref{graph:Error} se puede rescatar que, como se espera que suceda en una expansión, a medida que se agregan términos, la variación entre los valores va disminuyendo; esto es claro a partir del gráfico de Potencial v/s $n$, pero se hace más evidente en este caso.\\

\begin{figure}[h]
	\centering
	\includegraphics[scale = 0.45]{./Figures/Error_log}
	\caption{Variación porcentual, mostrada en escala logarítmica, de los resultados en función del número de cargas imagen.}\label{graph:Error_log}
\end{figure}

\noindent
Para ver qué tipo de decaimiento tiene el error, se grafica dicho eje (el de las ordenadas) en escala logarítmica. Como se ve en el gráfico \ref{graph:Error_log}, la relación se torna lineal, por lo que el error disminuye con el logaritmo de $n$.\\\\
Con esto queda definido que el método de imágenes aplicado a través de BEM sirve para modelar el potencial de una molécula, macromolécula o similar, embebida en una membrana con otro medio dieléctrico por fuera de las interfaces de esta última. El siguiente capítulo cierra las ideas desarrolladas en este escrito, y presenta además puntos que se considera importantes trabajar si es que se desea mejorar o continuar el hilo desarrollado en el presente texto.


%En la sección actual se presentan una serie de breves resúmenes de publicaciones relacionadas con la temática de modelos computacionales de células y/o biomoléculas, o que sean de aporte para el entendimiento de la teoría electrostática en alguna forma.
%\subsection{APBSmem: A Graphical Interface for Electrostatic Calculations at the Membrane \cite{APBSmem}}
%La publicación sobre APBSmem es más que nada una guía para la utilización del programa APBSmem, en la que se presentan además los métodos utilizados para el cálculo de energías de interés, en sistemas biológicos (proteína-membrana principalmente); esto puede ser, solvatación para iones, para proteínas, o canales transmembrana. 
%La bicapa consiste en ``planchas" de material dieléctrico con baja constante dieléctrica que se colocan de tal forma que limiten con la proteína y no sean parte de, en el caso que haya, las proteínas de canal. Para ubicar la membrana, el programa utiliza las posiciones espaciales de residuos hidrofóbicos como referencia, o también se puede acudir a la base de datos Orientations of Proteins in Membranes.\\\\
%Utilizando la ecuación PB lineal, el programa puede calcular el potencial de membrana o proteína por separado, en caso que sea requerido. Se incluyen las ecuaciones de PB para tres casos: bajo la membrana (dentro de la célula), en la membrana, y sobre esta (fuera de la célula). Esto se logra con la ecuación de Poisson-Boltzman linealizada y sumando un término para compensar por la diferencia de potencial entre el interior y el exterior; esta diferencia es producto de la concentración de iones (Potasio, Calcio, etc) al interior y exterior de la pared celular. Los potenciales del sistema vienen de la ecuación PB por fuera de la célula, PB modificado para dar cuenta de la concentración de iones dentro de la célula, y Poisson (Laplace) dentro en la membrana; para una bicapa con límites $z = L/2$ y $z = -L/2$, los potenciales son
%
%\begin{align}
%\phi_1(z) &= \frac{e}{k_BT}V_{in}\frac{1}{\frac{\epsilon_w}{\epsilon_m}\kappa L + 2}e^{\kappa(L/2 - z)} &z>L/2\\
%\phi_2(z) &= \frac{e}{k_BT}V_{in}\left(\frac{1}{2}-\frac{1}{\frac{\epsilon_w}{\epsilon_m}\kappa L + 2}\frac{\epsilon_w}{\epsilon_m}\kappa z\right) &-L/2 < z < L/2\\
%\arraycolsep=0.3in\def\arraystretch{2}
%\phi_3(z) &= \frac{e}{k_BT}V_{in}\left(1 - \frac{1}{\frac{\epsilon_w}{\epsilon_m}\kappa L + 2}e^{\kappa(z+ L/2)}\right)&z<-L/2
%\end{align}
%En este caso $\phi_{1,2,3}$ es el potencial producto de la membrana, $e$ es la carga del electrón, y $\kappa^2=\bar{\kappa}^2/\epsilon_w$ es una variable auxiliar relacionada con la longitud de Debye-Hückel $\bar{\kappa}$.\\\\
%El programa, según se escribe en la publicación, trabaja con el método de diferencias finitas para obtener el potencial. Se incluyen ejemplos para los tres casos de cálculos energéticos mencionados en el paper.
%\subsection{Image Approximations to Electrostatic Potentials in Layered Electrolytes/Dielectrics and an Ion-Channel Model.\cite{Huimin-Lin}}
%En esta publicación se estudia la ecuación de PB linealizada aproximada mediante el método de imágenes; en particular, se modela el campo de reacción del solvente y la membrana en presencia de un canal iónico. Para esto, los investigadores obtienen imágenes para las interfaces planas de la membrana y para una interfaz propia de un cilindro, que sirve para separar al canal iónico del resto del sistema estudiado. Se determina una aproximación por el método de imágenes dentro y fuera de la membrana y del cilindro. Se integran también los aportes iónicos de la solución al modelo, lo que genera una expansión en funciones ortogonales de $sin$ y $cos$ para el potencial de Coulomb y el campo de reacción en la membrana. De la publicación se tienen las expresiones para el potencial en la membrana, sobre ella y bajo ella en $z$. Además, las imágenes y sus posiciones se obtienen por uno de dos métodos. El primero es una solución de la minimización del error $L_2$ entre la expresión propuesta por el método RIC \cite{Pei-kun} y el método de múltiples imágenes, que presenta Wei Cai en otro paper \cite{Wei-Cai}.
%\begin{align*}
%\text{Sol. RIC}\qquad\qquad \phi_{rf} = &\sum_{\substack{k = -\infty\\
%k \neq 0}}^{k = \infty} \frac{q_k}{\epsilon_m|\vec{x} - \vec{x}_k|}\\
%\text{Sol. Mult. Im. Method}\qquad\qquad \phi_{irf} = & \frac{q_s}{\epsilon_m}\sum_{l}\frac{q_k}{|\vec{x} - \vec{x}_l|}
%\end{align*}
%La segunda alternativa es utilizar un método de ajuste tipo Prony para resolver el sistema, aplicando dicho ajuste a la expansión de Fourier. En el paper se menciona que no existe actualmente una forma de modelar los efectos de la solución electrolítica sobre el canal iónico mediante el método de imágenes. Para modelar el canal intermembrana a pesar de este obstáculo es que se propone el uso de un modelo híbrido: se utiliza el método de imágenes para modelar los potenciales de la membrana y del solvente. Se utiliza un cilindro para encerrar el canal, junto con parte del solvente y la membrana, y se calculan las condiciones en las interfaces correspondientes al cilindro con el método de imágenes. Con esto se puede utilizar otro método, como dinámica molecular, para realizar los cálculos correspondientes al canal intermembrana a partir del borde del cilindro, cuyas condiciones son ya conocidas.
%\subsection{Multiple-image treatment of induced charges in Monte Carlo simulations of electrolytes near a spherical dielectric interface \cite{Gan}}
%Se emplea el método de imágenes para simular un coloide esférico, en primera instancia sin carga. El coloide se considera un macroión, sumergido en un dieléctrico en el que hay más especies iónicas distribuidas. Para esto se ocupa la ecuación de Poisson para el potencial, que surge de aplicar $\nabla$ a la ecuación (7). Se tratan los iones del solvente como cargas puntuales, considerando de inmediato una formulación explícita del problema. Como el coloide no tiene carga, se trabaja con la ecuación de Laplace.\\\\
%Ahora, fuera del coloide esférico se tiene que
%\begin{equation*}
%\Phi(\vec{r}) = \Phi_{Coul}(\vec{r}) + \Phi_{pol}(\vec{r})
%\end{equation*}
%El potencial de polarización es el complejo en este problema, pues el de Coulomb es el ya conocido $q/(\epsilon|\vec{r}-\vec{r}_s|)$.\\\\
%Para el potencial de polarización se ubican cargas a lo largo de una recta, de tal forma que se genere la esfera para una carga $q$ real ubicada a una distancia $r_s$ del centro de referencia. Con una expansión harmónica, se puede reformular el potencial de polarización como las contribuciones de una carga $q_K = -\gamma a q/r_s$, llamada de Kelvin, y una distribución lineal de carga desde el origen hasta la posición de $q_K$. Esta se puede discretizar y llevar a una sumatoria de la forma
%\begin{gather*}
%\Phi_{pol}(\vec{r}) = \frac{q_K}{\epsilon|\vec{r} - \vec{r}_K} + \sum_{m = 1}^I \frac{q_m}{\epsilon|\vec{r} - \vec{x}_m|}\\
%q_m = \frac{\omega_m}{2}\frac{\gamma a q}{r_s}\qquad\qquad x_m = r_K\left(\frac{1-s_m}{2}\right)^{1/\sigma}
%\end{gather*}
%donde $\gamma=(\epsilon_{in} - \epsilon_{out})/(\epsilon_{in}+ \epsilon_{out})$, $\sigma = \epsilon_{out}/(\epsilon_{in} + \epsilon_{out})$, $a$ el radio del coloide esférico, $r_K$ es el radio de la carga de Kelvin desde el centro del sistema de referencia, y $q$ es la carga de prueba. A partir de esto, se puede aproximar la carga lineal distribuida mediante $I + 1$ cargas puntuales. Establecido esto, se utiliza un método de Monte Carlo para el cálculo de la energía potencial del coloide en el dieléctrico.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Conclusiones}
Para poder llevar a cabo este trabajo, se dedicó mucho tiempo al aprendizaje de la teoría y a la búsqueda de una forma de utilizar el método de imágenes para representar interfaces. Esto es de esperarse, pues lo que más esfuerzo toma aprender no es cómo utilizar una herramienta - en este caso \texttt{Python} y sus bibliotecas - sino qué es lo que se debe hacer con ella y, en caso de que falle, por qué hay problemas. Con esto mencionado, corresponde regresar a los objetivos planteados en la introducción de este escrito y preguntarse si efectivamente se lograron. En primer lugar, se logra averiguar sobre la forma de modelar interfaces paralelas mediante el método de imágenes, por lo que este punto se considera un éxito. En segundo lugar, dicho método es acoplado a \texttt{PyGBe} efectivamente, y cumple con errores porcentuales bajos, lo que lleva a tachar estos objetivos de la lista, pues se cumplen. En cuanto a tiempo de cálculo, la implementación hecha es bastante competitiva, como se ya se mencionó en la sección \ref{Sec:analisis_resultados}. Con todos estas metas cumplidas, la modificación hecha a \texttt{PyGBe} para incluir una forma básica de una ``membrana" se puede considerar exitosa, pero tiene una falencia clave que consiste en el alto consumo de memoria que va ligado a $n$, el número de imágenes \textbf{por} elemento de borde. Sin embargo, la cercanía de los resultados a aquellos obtenidos con \texttt{APBSmem} da cuenta de la eficacia del método estudiado en este trabajo. Por lo tanto, y como conclusión, se puede afirmar que la prueba de concepto cumple con lo que se esperaba y de la forma que se esperaba; los tiempos de cálculo para \texttt{PyGBe} mejorarán automáticamente si se logra reducir el número de imágenes necesarias para alcanzar resultados con buena precisión. También se rescata de este trabajo que, para casos en que se requieran dominios de integración muy grandes (esto en \texttt{APBS - APBSmem}), \texttt{PyGBe} es mucho más eficiente en cuanto a velocidad de cálculo, debido a que el programa de referencia debe generar los mapas pertinentes, luego modificarlos para incluir la membrana, y finalmente, después de todo esto, realizar los cálculos.
\section{Continuación del trabajo}
Se deben realizar una serie de mejoras y cambios a \texttt{PyGBe} en su estado actual para realmente hacerlo un competidor fuerte en el cálculo de energías de sistemas molécula - mebrana. Estos cambios quedan como trabajos futuros, pero al menos en cierta forma parten de lo que se plasma en este informe. Primero esta lo más importante, que realmente lo haría funcionalmente interesante, y que corresponde a la capacidad de calcular energías para moléculas que tienen elementos dentro \textbf{y fuera} de la membrana: las proteínas transmembrana. Es decir, moléculas o macromoléculas que están parcialmente embebidas en la membrana, pero que tienen residuos que son hidrofílicos y por ende también hacen que esté en contacto con el solvente de forma directa (figura \ref{Fig:Fig_5-2} por ejemplo).\\\\
Otra modificación que se vuelve atractiva es la inclusión del efecto de iones salinos a través de la ecuación de Poisson - Boltzmann por fuera de la membrana. Ya existen trabajos al respecto, como aquel por Lin, Xu, Tang y Cai \cite{Huimin-Lin}, que formulan el método de elementos de borde para una distribución de iones dada por la ecuación PB; la idea ahora es acoplar dicha formulación para incluirla en \texttt{PyGBe}, aprovechando las otras ventajas de este software.\\\\
Por último, una mejora evidente que se requiere es reducir la cantidad de memoria que se debe dedicar para estos cálculos mediante el método de imágenes, pues este resulta el principal obstáculo en este momento.\\\\
Otras formas de mejorar la precisión del modelo pueden venirse a la mente, pues aún queda mucho trabajo por delante, pero remitiéndose al marco de esta investigación, se logran los objetivos principales, se prueba de forma categórica que el método de imágenes sirve para cálculos de moléculas \textbf{en} membranas, y además se crea una pequeña base teórica para hacer más fluida la continuación de esta línea de investigación en el futuro, si llegara a darse el caso.

\appendix

\include{Anexos/Anexo_Bromoethane}
\pagebreak
\include{Anexos/Anexo_Solv_Energy}
\pagebreak
\include{Anexos/Anexo_APBS}
\pagebreak

\nocite{*}
\bibliography{bibliografia}
%\begin{thebibliography}{150}
%\bibitem{Jackson}
%Jackson, J. D. \textit{Classical Electrodynamics}, Third Edition; Wiley, 1998
%\bibitem{Griffiths}
%Griffiths, D. J. \textit{Introduction to Electrodynamics}, Third Edition; Prentice Hall, 1999
%\bibitem{Kantorovich}
%Kantorovich, L. \textit{Quantum Theory of the Solid State: An Introduction}, First Edition; Springer, 2004
%\bibitem{Cai}
%Cai, W. \textit{Computational Methods for Electromagnetic Phenomena}, First Edition; Cambridge University Press, 2013
%\bibitem{Brebbia}
%Brebbia, C. A.; Dominguez J. \textit{Boundary Elements: An Introductory Course}, Second Edition; WIT Press, 1992
%\bibitem{Cooper2015}
%Cooper, C. \textit{Biomolecular Electrostatics With Continuum Models: A Boundary Integral Implementation and Applications to Biosensors}, 2015
%\bibitem{Pei-kun}
%Yang, P.; Liaw, S.; Lim, C. \textit{Representing an Infinite Solvent System with a Rectangular Finite System Using Image Charges}, J. Phys. Chem. B 2002, 106, 2973-2982
%\bibitem{APBSmem}
%Callenberg, K. M.; Choudhary, O. P.; de Forest, G. L.; Gohara, D. W.; Baker, N. A.; Grabe, M. \textit{APBSmem: A Graphical Interface for Electrostatic Calculations at the Membrane}, PLoS ONE 5(9), 2010
%\bibitem{Huimin-Lin}
%Lin, H.; Xu, Z.; Tang, H.; Cai, W. \textit{Image Approximations to Electrostatic Potentials in Layered Electrolytes/Dielectrics and an Ion-Channel Model}, J. Sci. Comput., 2011
%\bibitem{Wei-Cai}
%Cai, W.; Deng, S.; Jacobs, D. \textit{Extending the fast multipole method to charges inside or outside a dielectric sphere}, J. Comput. Phys. 223, 2007
%\bibitem{Gan}
%Gan, Z.; Xu, Z. \textit{Multiple-image treatment of induced charges in Monte Carlo simulations of electrolytes near a spherical dielectric interface}, Phys. Rev. E 84, 016705, 2011
%\bibitem{Roux}
%Roux, B. \textit{Influence of the Membrane Potential on the Free Energy of an Intrinsic Protein}, Byophysical Journal, Vol. 73, 2980-2989, 1997
%\bibitem{Campbell}
%Campbell, N.; Reece, J. \textit{Biología}, Séptima Edición, Editorial Médica Panamericana, 2007
%\bibitem{Alberts}
%Alberts, B. et al. \textit{Molecular Biology of the Cell}, Sixth Edition, Garland Science, 2015
%\bibitem{Lombard}
%Lombard, J. \textit{Once upon a time the cell membranes: 175 years of cell boundary research}, Biology Direct 9:32, 2014
%\bibitem{Zhu}
%Zhenhai, Z.; Jingfang, H.; Song, B.; White, J. \textit{Improving the Robustness of a Surface Integral Formulation for Wideband Impedance Extraction of 3D Structures}, IEEE/ACM International Conference on Computer Aided Design. 592-597, 2001
%\bibitem{Hess}
%Hess, J.; Smith, A. \textit{Calculation of Potential Flow About Arbitrary Bodies}, Progress in Aerospace Sciences, Vol. 8, 1-138, 1967
%\bibitem{Durand}
%Durand, E. \textit{Électrostatique Vol. III Méthodes de Calcul Diélectriques}, Masson et Cie.; 1966
%\bibitem{pdb2pqr_1}
%https://apbs-pdb2pqr.readthedocs.io/en/latest/index.html
%\bibitem{pdb2pqr_2}
%https://apbs-pdb2pqr.readthedocs.io/en/latest/formats/pqr.html
%\bibitem{glossary_of_chem_terms}
%\textit{GLOSSARY OF TERMS USED IN THEORETICAL ORGANIC CHEMISTRY}, Pure Appl. Chem., Vol. 71, No. 10, pp. 1919-1981, 1999.
%\bibitem{apbsmem_website}
%https://apbsmem.sourceforge.io
%\end{thebibliography}

\end{document}